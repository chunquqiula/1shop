!function(t,e){function a(t,e,a){var i=t.children(),o=!1;t.empty();for(var r=0,s=i.length;s>r;r++){var c=i.eq(r);if(t.append(c),a&&t.append(a),n(t,e)){c.remove(),o=!0;break}a&&a.detach()}return o}function i(e,a,r,s,c){var l=!1,d="a, table, thead, tbody, tfoot, tr, col, colgroup, object, embed, param, ol, ul, dl, blockquote, select, optgroup, option, textarea, script, style",u="script, .dotdotdot-keep";return e.contents().detach().each(function(){var p=this,m=t(p);if("undefined"==typeof p)return!0;if(m.is(u))e.append(m);else{if(l)return!0;e.append(m),!c||m.is(s.after)||m.find(s.after).length||e[e.is(d)?"after":"append"](c),n(r,s)&&(l=3==p.nodeType?o(m,a,r,s,c):i(m,a,r,s,c)),l||c&&c.detach()}}),a.addClass("is-truncated"),l}function o(e,a,i,o,s){var d=e[0];if(!d)return!1;var p=l(d),m=-1!==p.indexOf(" ")?" ":"　",h="letter"==o.wrap?"":m,f=p.split(h),v=-1,g=-1,_=0,b=f.length-1;if(o.fallbackToLetter&&0===_&&0===b&&(h="",f=p.split(h),b=f.length-1),o.maxLength)p=r(p.trim().substr(0,o.maxLength),o),c(d,p);else{for(;b>=_&&(0!==_||0!==b);){var y=Math.floor((_+b)/2);if(y==g)break;g=y,c(d,f.slice(0,g+1).join(h)+o.ellipsis),i.children().each(function(){t(this).toggle().toggle()}),n(i,o)?(b=g,o.fallbackToLetter&&0===_&&0===b&&(h="",f=f[0].split(h),v=-1,g=-1,_=0,b=f.length-1)):(v=g,_=g)}if(-1==v||1===f.length&&0===f[0].length){var k=e.parent();e.detach();var w=s&&s.closest(k).length?s.length:0;if(k.contents().length>w?d=u(k.contents().eq(-1-w),a):(d=u(k,a,!0),w||k.detach()),d&&(p=r(l(d),o),c(d,p),w&&s)){var C=s.parent();t(d).parent().append(s),t.trim(C.html())||C.remove()}}else p=r(f.slice(0,v+1).join(h),o),c(d,p)}return!0}function n(t,e){return t.innerHeight()>e.maxHeight||e.maxLength&&t.text().trim().length>e.maxLength}function r(e,a){for(;t.inArray(e.slice(-1),a.lastCharacter.remove)>-1;)e=e.slice(0,-1);return t.inArray(e.slice(-1),a.lastCharacter.noEllipsis)<0&&(e+=a.ellipsis),e}function s(t){return{width:t.innerWidth(),height:t.innerHeight()}}function c(t,e){t.innerText?t.innerText=e:t.nodeValue?t.nodeValue=e:t.textContent&&(t.textContent=e)}function l(t){return t.innerText?t.innerText:t.nodeValue?t.nodeValue:t.textContent?t.textContent:""}function d(t){do t=t.previousSibling;while(t&&1!==t.nodeType&&3!==t.nodeType);return t}function u(e,a,i){var o,n=e&&e[0];if(n){if(!i){if(3===n.nodeType)return n;if(t.trim(e.text()))return u(e.contents().last(),a)}for(o=d(n);!o;){if(e=e.parent(),e.is(a)||!e.length)return!1;o=d(e[0])}if(o)return u(t(o),a)}return!1}function p(e,a){return!!e&&("string"==typeof e?(e=t(e,a),!!e.length&&e):!!e.jquery&&e)}function m(t){for(var e=t.innerHeight(),a=["paddingTop","paddingBottom"],i=0,o=a.length;o>i;i++){var n=parseInt(t.css(a[i]),10);isNaN(n)&&(n=0),e-=n}return e}if(!t.fn.dotdotdot){t.fn.dotdotdot=function(e){if(0===this.length)return t.fn.dotdotdot.debug('No element found for "'+this.selector+'".'),this;if(this.length>1)return this.each(function(){t(this).dotdotdot(e)});var o=this,r=o.contents();o.data("dotdotdot")&&o.trigger("destroy.dot"),o.data("dotdotdot-style",o.attr("style")||""),o.css("word-wrap","break-word"),"nowrap"===o.css("white-space")&&o.css("white-space","normal"),o.bind_events=function(){return o.bind("update.dot",function(e,s){switch(o.removeClass("is-truncated"),e.preventDefault(),e.stopPropagation(),typeof c.height){case"number":c.maxHeight=c.height;break;case"function":c.maxHeight=c.height.call(o[0]);break;default:c.maxHeight=m(o)}c.maxHeight+=c.tolerance,"undefined"!=typeof s&&(("string"==typeof s||"nodeType"in s&&1===s.nodeType)&&(s=t("<div />").append(s).contents()),s instanceof t&&(r=s)),f=o.wrapInner('<div class="dotdotdot" />').children(),f.contents().detach().end().append(r.clone(!0)).find("br").replaceWith("  <br />  ").end().css({height:"auto",width:"auto",border:"none",padding:0,margin:0});var d=!1,u=!1;return l.afterElement&&(d=l.afterElement.clone(!0),d.show(),l.afterElement.detach()),n(f,c)&&(u="children"==c.wrap?a(f,c,d):i(f,o,f,c,d)),f.replaceWith(f.contents()),f=null,t.isFunction(c.callback)&&c.callback.call(o[0],u,r),l.isTruncated=u,u}).bind("isTruncated.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(o[0],l.isTruncated),l.isTruncated}).bind("originalContent.dot",function(t,e){return t.preventDefault(),t.stopPropagation(),"function"==typeof e&&e.call(o[0],r),r}).bind("destroy.dot",function(t){t.preventDefault(),t.stopPropagation(),o.unwatch().unbind_events().contents().detach().end().append(r).attr("style",o.data("dotdotdot-style")||"").removeClass("is-truncated").data("dotdotdot",!1)}),o},o.unbind_events=function(){return o.unbind(".dot"),o},o.watch=function(){if(o.unwatch(),"window"==c.watch){var e=t(window),a=e.width(),i=e.height();e.bind("resize.dot"+l.dotId,function(){a==e.width()&&i==e.height()&&c.windowResizeFix||(a=e.width(),i=e.height(),u&&clearInterval(u),u=setTimeout(function(){o.trigger("update.dot")},100))})}else d=s(o),u=setInterval(function(){if(o.is(":visible")){var t=s(o);d.width==t.width&&d.height==t.height||(o.trigger("update.dot"),d=t)}},500);return o},o.unwatch=function(){return t(window).unbind("resize.dot"+l.dotId),u&&clearInterval(u),o};var c=t.extend(!0,{},t.fn.dotdotdot.defaults,e),l={},d={},u=null,f=null;return c.lastCharacter.remove instanceof Array||(c.lastCharacter.remove=t.fn.dotdotdot.defaultArrays.lastCharacter.remove),c.lastCharacter.noEllipsis instanceof Array||(c.lastCharacter.noEllipsis=t.fn.dotdotdot.defaultArrays.lastCharacter.noEllipsis),l.afterElement=p(c.after,o),l.isTruncated=!1,l.dotId=h++,o.data("dotdotdot",!0).bind_events().trigger("update.dot"),c.watch&&o.watch(),o},t.fn.dotdotdot.defaults={ellipsis:"... ",wrap:"word",fallbackToLetter:!0,lastCharacter:{},tolerance:0,callback:null,after:null,height:null,watch:!1,windowResizeFix:!0,maxLength:null},t.fn.dotdotdot.defaultArrays={lastCharacter:{remove:[" ","　",",",";",".","!","?"],noEllipsis:[]}},t.fn.dotdotdot.debug=function(){};var h=1,f=t.fn.html;t.fn.html=function(a){return a!=e&&!t.isFunction(a)&&this.data("dotdotdot")?this.trigger("update",[a]):f.apply(this,arguments)};var v=t.fn.text;t.fn.text=function(a){return a!=e&&!t.isFunction(a)&&this.data("dotdotdot")?(a=t("<div />").text(a).html(),this.trigger("update",[a])):v.apply(this,arguments)}}}(jQuery),jQuery(document).ready(function(t){t(".dot-ellipsis").each(function(){var e=t(this).hasClass("dot-resize-update"),a=t(this).hasClass("dot-timer-update"),i=0,o=t(this).attr("class").split(/\s+/);t.each(o,function(t,e){var a=e.match(/^dot-height-(\d+)$/);null!==a&&(i=Number(a[1]))});var n={};a&&(n.watch=!0),e&&(n.watch="window"),i>0&&(n.height=i),t(this).dotdotdot(n)})}),jQuery(window).on("load",function(){jQuery(".dot-ellipsis.dot-load-update").trigger("update.dot")}),define("dotdotdot",function(){}),function(t){t.fn.extend({PopupDialog:function(e){var a={popupClass:"",maskLayer:!0,delayClose:null,callback:function(){},cancelCallback:function(){}},e=t.extend(!0,a,e);return this.each(function(){var a,i=(t(this),t(e.popupClass).outerWidth()),o=t(e.popupClass).outerHeight(),n=t(window).scrollTop(),r=t(window).height(),s=t(document).height(),c={init:function(){var a=(r-o)/2+n,s=n>a?n:a;t(e.popupClass).css({marginLeft:-(i/2),top:s,display:"block"}),t(".pop_close",e.popupClass).unbind("click").bind("click",c.layerClose),t(".cancel",e.popupClass).bind("click",function(){e.cancelCallback()}),t(".confirm",e.popupClass).bind("click",function(){e.callback()}),e.maskLayer&&c.maskModel(),null!=e.delayClose&&c.delayModel()},maskModel:function(){t(e.popupClass).after("<div class='popup_mask'></div>"),t(".popup_mask").css("height",s),/msie\s+[5-6]\./i.test(window.navigator.userAgent)&&(t(".popup_mask").after("<iframe class='popup_iframe' frameborder='0'></iframe>"),t(".popup_iframe").css("height",s))},layerClose:function(){window.clearInterval(a),t(e.popupClass).hide(),t(".popup_mask").remove(),t(".popup_iframe").remove()},delayModel:function(){t(".delayClose",e.popupClass).text(e.delayClose);var i=e.delayClose;a=setInterval(function(){1==i?(window.clearInterval(a),c.layerClose()):(i--,t(".delayClose",e.popupClass).text(i))},1e3)}};c.init()}),this}})}(jQuery),define("dialog",function(){}),function(t){t.fn.extend({scrollPlugin:function(e){var a={prevClassName:".left_arrow",nextClassName:".right_arrow",disableClass:"unable",disableStyle:{opacity:".2",cursor:"default"},slideClassName:".sale_scroll_ul",distance:"screen",viewDot:"false",showItem:"",speed:400,callBack:function(){}},e=t.extend(!0,a,e);return this.each(function(){var a,i,o,n=t(this),r=t(e.prevClassName,n),s=t(e.nextClassName,n),c=t(e.slideClassName,n),l=c.find("li").length,d=c.find("li").outerWidth(!0),u=0,p=e.showItem?e.showItem:Math.round(n.width()/d);switch(e.distance){case"single":a=d,i=l-p;break;case"screen":a=d*p,i=Math.ceil(l/p)-1}if(0>=i)return r.hide(),s.hide(),!1;var m={init:function(){c.css({width:d*l}),r.addClass(e.disableClass).unbind("click").bind("click",m.rightScroll),s.unbind("click").bind("click",m.leftScroll),m.dotViewEvent(),e.callBack()},leftScroll:function(){c.is(":animated")||(u+=1,u==i+1?u=i:"",u==i?m.toLastPage():m.showPlay("-",a),r.removeClass(e.disableClass),m.dotHighlight())},rightScroll:function(){c.is(":animated")||(u-=1,-1==u?u=0:"",0==u?m.toFirstPage():m.showPlay("+",a),s.removeClass(e.disableClass),m.dotHighlight())},showPlay:function(t,a){c.stop(!0,!0).animate({marginLeft:""+t+"="+a},e.speed)},toLastPage:function(){s.addClass(e.disableClass),r.removeClass(e.disableClass),c.stop(!0,!0).animate({marginLeft:-(l-p)*d},e.speed)},toFirstPage:function(){r.addClass(e.disableClass),s.removeClass(e.disableClass),c.stop(!0,!0).animate({marginLeft:0},e.speed)},renderDotView:function(){var t=n.find(".view_dot"),e='<div class="view_dot"><span class="cur"></span>';t.length&&t.remove();for(var a=0;i>a;a++)e+="<span></span>";e+="</div>",n.append(e)},dotViewEvent:function(){"dot"==e.viewDot&&(m.renderDotView(),o=n.find(".view_dot").children("span"),o.unbind("click").bind("click",function(){var o=t(this),c=n.find(".cur").index();u=o.index(),o.addClass("cur").siblings().removeClass("cur"),u==i?m.toLastPage():0==u?m.toFirstPage():(s.removeClass(e.disableClass),r.removeClass(e.disableClass),u>c?m.showPlay("-",(u-c)*a):m.showPlay("+",(c-u)*a))}))},dotHighlight:function(){"dot"==e.viewDot&&(o=n.find(".view_dot").children("span"),o.eq(u).addClass("cur").siblings().removeClass("cur"))}};m.init()}),this}})}(jQuery),define("scroll",function(){});var funParabola=function(t,e,a){var i={speed:166.67,curvature:.001,progress:function(){},complete:function(){}},o={};a=a||{};for(var n in i)o[n]=a[n]||i[n];var r={mark:function(){return this},position:function(){return this},move:function(){return this},init:function(){return this}},s="margin",c=document.createElement("div");"oninput"in c&&["","ms","webkit"].forEach(function(t){var e=t+(t?"T":"t")+"ransform";e in c.style&&(s=e)});var l=o.curvature,d=0,u=!0;if(t&&e&&1==t.nodeType&&1==e.nodeType){var p={},m={},h={},f={},v={},g={};r.mark=function(){return 0==u?this:("undefined"==typeof v.x&&this.position(),t.setAttribute("data-center",[v.x,v.y].join()),e.setAttribute("data-center",[g.x,g.y].join()),this)},r.position=function(){if(0==u)return this;var a=document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.scrollTop||document.body.scrollTop;return"margin"==s?t.style.marginLeft=t.style.marginTop="0px":t.style[s]="translate(0, 0)",p=t.getBoundingClientRect(),m=e.getBoundingClientRect(),h={x:p.left+(p.right-p.left)/2+a,y:p.top+(p.bottom-p.top)/2+i},f={x:m.left+(m.right-m.left)/2+a,y:m.top+(m.bottom-m.top)/2+i},v={x:0,y:0},g={x:-1*(h.x-f.x),y:-1*(h.y-f.y)},d=(g.y-l*g.x*g.x)/g.x,this},r.move=function(){if(0==u)return this;var e=0,a=g.x>0?1:-1,i=function(){var n=2*l*e+d;e+=a*Math.sqrt(o.speed/(n*n+1)),(1==a&&e>g.x||-1==a&&e<g.x)&&(e=g.x);var r=e,c=l*r*r+d*r;t.setAttribute("data-center",[Math.round(r),Math.round(c)].join()),"margin"==s?(t.style.marginLeft=r+"px",t.style.marginTop=c+"px"):t.style[s]="translate("+[r+"px",c+"px"].join()+")",e!==g.x?(o.progress(r,c),window.requestAnimationFrame(i)):(o.complete(),u=!0)};return window.requestAnimationFrame(i),u=!1,this},r.init=function(){this.position().mark().move()}}return r};!function(){for(var t=0,e=["webkit","moz"],a=0;a<e.length&&!window.requestAnimationFrame;++a)window.requestAnimationFrame=window[e[a]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[a]+"CancelAnimationFrame"]||window[e[a]+"CancelRequestAnimationFrame"];window.requestAnimationFrame||(window.requestAnimationFrame=function(e){var a=(new Date).getTime(),i=Math.max(0,16.7-(a-t)),o=window.setTimeout(function(){e(a+i)},i);return t=a+i,o}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)})}(),define("parabola",function(){}),function(){function t(e,a,i){return("string"==typeof a?a:a.toString()).replace(e.define||n,function(t,a,o,n){return 0===a.indexOf("def.")&&(a=a.substring(4)),a in i||(":"===o?(e.defineParams&&n.replace(e.defineParams,function(t,e,o){i[a]={arg:e,text:o}}),a in i||(i[a]=n)):new Function("def","def['"+a+"']="+n)(i)),""}).replace(e.use||n,function(a,o){e.useParams&&(o=o.replace(e.useParams,function(t,e,a,o){if(i[a]&&i[a].arg&&o){var n=(a+":"+o).replace(/'|\\/g,"_");return i.__exp=i.__exp||{},i.__exp[n]=i[a].text.replace(new RegExp("(^|[^\\w$])"+i[a].arg+"([^\\w$])","g"),"$1"+o+"$2"),e+"def.__exp['"+n+"']"}}));var n=new Function("def","return "+o)(i);return n?t(e,n,i):n})}function e(t){return t.replace(/\\('|\\)/g,"$1").replace(/[\r\t\n]/g," ")}var a,i={version:"1.1.1",templateSettings:{evaluate:/\{\{([\s\S]+?(\}?)+)\}\}/g,interpolate:/\{\{=([\s\S]+?)\}\}/g,encode:/\{\{!([\s\S]+?)\}\}/g,use:/\{\{#([\s\S]+?)\}\}/g,useParams:/(^|[^\w$])def(?:\.|\[[\'\"])([\w$\.]+)(?:[\'\"]\])?\s*\:\s*([\w$\.]+|\"[^\"]+\"|\'[^\']+\'|\{[^\}]+\})/g,define:/\{\{##\s*([\w\.$]+)\s*(\:|=)([\s\S]+?)#\}\}/g,defineParams:/^\s*([\w$]+):([\s\S]+)/,conditional:/\{\{\?(\?)?\s*([\s\S]*?)\s*\}\}/g,iterate:/\{\{~\s*(?:\}\}|([\s\S]+?)\s*\:\s*([\w$]+)\s*(?:\:\s*([\w$]+))?\s*\}\})/g,varname:"it",strip:!0,append:!0,selfcontained:!1,doNotSkipEncoded:!1},template:void 0,compile:void 0,log:!0};i.encodeHTMLSource=function(t){var e={"&":"&#38;","<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","/":"&#47;"},a=t?/[&<>"'\/]/g:/&(?!#?\w+;)|<|>|"|'|\//g;return function(t){return t?t.toString().replace(a,function(t){return e[t]||t}):""}},a=function(){return this||(0,eval)("this")}(),"undefined"!=typeof module&&module.exports?module.exports=i:"function"==typeof define&&define.amd?define("doT",[],function(){return i}):a.doT=i;var o={append:{start:"'+(",end:")+'",startencode:"'+encodeHTML("},split:{start:"';out+=(",end:");out+='",startencode:"';out+=encodeHTML("}},n=/$^/;i.template=function(r,s,c){s=s||i.templateSettings;var l,d,u=s.append?o.append:o.split,p=0,m=s.use||s.define?t(s,r,c||{}):r;m=("var out='"+(s.strip?m.replace(/(^|\r|\n)\t* +| +\t*(\r|\n|$)/g," ").replace(/\r|\n|\t|\/\*[\s\S]*?\*\//g,""):m).replace(/'|\\/g,"\\$&").replace(s.interpolate||n,function(t,a){return u.start+e(a)+u.end}).replace(s.encode||n,function(t,a){return l=!0,u.startencode+e(a)+u.end}).replace(s.conditional||n,function(t,a,i){return a?i?"';}else if("+e(i)+"){out+='":"';}else{out+='":i?"';if("+e(i)+"){out+='":"';}out+='"}).replace(s.iterate||n,function(t,a,i,o){return a?(p+=1,d=o||"i"+p,a=e(a),"';var arr"+p+"="+a+";if(arr"+p+"){var "+i+","+d+"=-1,l"+p+"=arr"+p+".length-1;while("+d+"<l"+p+"){"+i+"=arr"+p+"["+d+"+=1];out+='"):"';} } out+='"}).replace(s.evaluate||n,function(t,a){return"';"+e(a)+"out+='"})+"';return out;").replace(/\n/g,"\\n").replace(/\t/g,"\\t").replace(/\r/g,"\\r").replace(/(\s|;|\}|^|\{)out\+='';/g,"$1").replace(/\+''/g,""),l&&(s.selfcontained||!a||a._encodeHTML||(a._encodeHTML=i.encodeHTMLSource(s.doNotSkipEncoded)),m="var encodeHTML = typeof _encodeHTML !== 'undefined' ? _encodeHTML : ("+i.encodeHTMLSource.toString()+"("+(s.doNotSkipEncoded||"")+"));"+m);try{return new Function(s.varname,m)}catch(h){throw"undefined"!=typeof console&&console.log("Could not create a template function: "+m),h}},i.compile=function(t,e){return i.template(t,null,e)}}(),define("utils",["jquery","doT"],function(t){function e(t){return t&&"object"==typeof t&&Array==t.constructor}Array.prototype.remove=function(t,e){var a=this.slice((e||t)+1||this.length);return this.length=0>t?this.length+t:t,this.push.apply(this,a)},Array.prototype.insert=function(t,e){this.splice(t,0,e)},Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var a in e)new RegExp("("+a+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[a]:("00"+e[a]).substr((""+e[a]).length)));return t},Date.prototype.hoursDiff=function(t){return parseInt(Math.abs(this.getTime()-t.getTime())/36e5)};{var a={};document.location.href}return a.isReqSuccess=function(t){return t&&"00000000"==t.code},a.unique=function(t){for(var e,a=[],i={},o=0;null!=(e=t[o]);o++)i[e]||(a.push(e),i[e]=!0);return a},a.checkLogin=function(e){if(!e)return!1;var a="https://passport.yhd.com/publicPassport/isLogin.do?callback=?";t.ajax({type:"get",url:a,dataType:"json",success:function(t){return"1"==t.result?void e(!0):void e(!1)},error:function(){e(!1)}})},window.getTestJson=function(e,a){t.ajax({url:"/statics/testData/"+e,cache:!1,async:!1,type:"GET",dataType:"json",success:function(t){a(t)}})},a.getUserLoggedInPage=function(){return t("#userLoggedInPage").val()},a.getParamStrFromJson=function(t){var a,i,o="";for(var n in t)if(t[n])if(t.hasOwnProperty(n)&&(a=n),i=t[n],e(i))for(var r=0;r<i.length;r++)o+="&"+a+"="+encodeURIComponent(i[r]);else o+="&"+a+"="+encodeURIComponent(i);return o.substring(1,o.length)},a.getByteLen=function(t){for(var e=0,a=0;a<t.length;a++){var i=t.charAt(a);e+=null!=i.match(/[^\x00-\xff]/gi)?2:1}return e},a.getCookie=function(t){for(var e=document.cookie.split("; "),a=0;a<e.length;a++){var i=e[a].split("=");if(i[0]==t)return unescape(i[1])}},a.zoomImg=function(t,e){if(!t||!e)return t||"//image.yihaodianimg.com/front-homepage/global/images/defaultproduct.jpg";var a=t.lastIndexOf(".",t.lenght-4);return t.substring(0,a)+"_"+e+"x"+e+t.substring(a)},a}),define("newCart",["jquery","dialog","scroll","parabola","utils","doT","require"],function(t,e,a,i,o,n,r){function s(e){function a(){var e=t(".check_item").map(function(){return t(this).hasClass("checked")?"1":void 0}).get().join(","),a=o.unique(e.split(","));if(e.length>0||a.length>1){var i=t(".check_item.checked"),n=t(".check_item.checked.oversea"),r=t(".check_item.checked:not(.oversea)"),s=[];if(0==n.length||n.length==i.length)s=i,c(s,[]);else{var l=0,d=0;t(n).each(function(){return l=parseInt(l)+parseInt(t(this).siblings(".item_num").find("input[class='input']").val())}),t(r).each(function(){return d=parseInt(d)+parseInt(t(this).siblings(".item_num").find("input[class='input']").val())}),t(".oversea_icon").find("span").html("海购商品（"+l+"）件"),t(".normal_icon").find("span").html("普通商品（"+d+"）件"),t(this).PopupDialog({popupClass:".split_payfor_pop",delayClose:null,maskLayer:!0}),t("body").on("click",".split_payfor_pop li",function(){t(this).addClass("v_choose").siblings("li").removeClass("v_choose")});var u=[];t(".confirm.pop_close.oversea").on("click",function(){t(".oversea_icon").hasClass("v_choose")&&(u=r,s=n),t(".normal_icon").hasClass("v_choose")&&(u=n,s=r),c(s,u)})}}}var i=t(".pay_tools_r .checkout_btn");if(e){var n=t(".check_item").map(function(){return t(this).hasClass("checked")?"1":void 0}).get().join(",");n&&n.length>0?(i.removeClass("unable"),i.off().on("click",a)):i.addClass("unable")}else i.addClass("unable"),i.unbind("click")}function c(e,a){var i=t(e).map(function(){return t(this).parents(".cart_prod").hasClass("unable")?'<li class = clearfix><div class = nu_pic><a><img src="'+t(this).siblings(".item_pic").find("img").attr("src")+"\" width='50' height='50'></a></div><div class = nu_txt><a>"+t(this).siblings(".item_tit").text()+"</a></div></li>":void 0}).get().join("");if(t(".null_payfor_pop").find(".npay_ulbox").html(i),i.length>0)t(this).PopupDialog({popupClass:".null_payfor_pop",delayClose:null,maskLayer:!0}),t(".confirm.pop_close.no_stock").on("click",function(){var i=0,o=t(e).map(function(){return t(this).parents(".cart_prod").hasClass("unable")?d(this,i++):void 0}).get().join("&");a.length>0&&(o=o+"&"+t(a).map(function(){return d(this,i++)}).get().join("&")),u(o),yhdPublicLogin.checkLogin(function(t){t?window.location.href="//trade.yhd.com/shopping/order/getOrderInfo.do":yhdPublicLogin.showLoginDivNone(URLPrefix_passport,!1,"",l,2)})});else{if(a.length>0){var o=0,n=t(a).map(function(){return d(this,o++)}).get().join("&");u(n)}yhdPublicLogin.checkLogin(function(t){t?window.location.href="//trade.yhd.com/shopping/order/getOrderInfo.do":yhdPublicLogin.showLoginDivNone(URLPrefix_passport,!1,"",l,2)})}}function l(){window.location.href="/cart/mod/mergeCart.do"}function d(e,a){var i=t(e).parents(".main_item").data("identifier");e=window.itemData[i];var o=4==e.itemType?e.promotionId:e.sku.id,n=e.itemType,r=e.promotionId?e.promotionId:0,s="skuItems["+a+"]";return s+".itemId="+o+"&"+s+".itemType="+n+"&"+s+".targetId="+r}function u(e){var a="/cart/opt/uncheckItems.do?"+e+"&callback=?";t.ajax({url:a,dataType:"json",async:!1,success:function(){return"success"}})}var p={};p.cart_province_id="",p.cart_province_name="",p.cart_city_id="",p.cart_city_name="",p.cart_county_id="",p.cart_county_name="",p.oldProvinceId="";var m="";return p.initClass=function(){function e(){t(".pay_tools_bar").removeClass("tools_bar_bottom tools_bar_top"),p.columnBar()}function a(){t(".cart_item").each(function(){var e=t(this).find("li").find(".l2"),a=t(this).find("li").last(),i=a.find(".l2");a.find(".group_detail").length>0&&i.is(":visible")?i.slideDown():(e.show(),i.slideUp())}),t(".cart_list").each(function(){0==t(this).find(".cart_item").length&&t(this).hide()})}e(),a()},p.areaInit=function(){if(cart_province_id=t("#cart_province_id").val(),"undefined"==typeof cart_province_id)return!1;cart_province_name=t("#cart_province_name").val().replace("<i></i>",""),cart_city_id=t("#cart_city_id").val(),cart_city_name=t("#cart_city_name").val().replace("<i></i>",""),cart_county_id=t("#cart_county_id").val(),cart_county_name=t("#cart_county_name").val().replace("<i></i>","");t('dd[name="cart_province"]').each(function(){t(this).attr("value")==cart_province_id?(cart_province_name=t(this).html(),t(this).addClass("on")):t(this).removeClass("on")}),t("#detail_area_name").html(cart_county_name.length>0&&"0"!=cart_county_name?cart_province_name+"<i>|</i>"+cart_city_name+"<i>|</i>"+cart_county_name:cart_city_name.length>0?cart_province_name+"<i>|</i>"+cart_city_name:cart_province_name);{var e=t(".mod_area_select"),a=(e.find(".address"),e.find(".tab_box"),e.find(".tabs span"));e.find(".area_box .item"),e.find(".val_text"),e.offset().top+32}a.eq(0).html("<em>"+cart_province_name+"</em>"),cart_city_name.length>0?a.eq(1).html("<em>"+cart_city_name+"</em>"):(m="请选择市",a.eq(1).html("<em>"+m+"</em>")),cart_county_name.length>0&&"0"!=cart_county_name?a.eq(2).html("<em>"+cart_county_name+"</em>"):(countyTip="请选择区",a.eq(2).html("<em>"+countyTip+"</em>"))},p.modAreaSelect=function(){t(".mod_area_select").each(function(){function e(){n.removeClass("select"),s.hide(),o.isOpen=!1,t(o).css({position:"relative",top:0})}function a(e,a){var o,n;if(1==a){t("#cart_county_area").empty();var o="/cart/opt/getCitiesByProvinceId.do?provinceId="+e+"&callback=?";n="cart_city"}else if(2==a){var o="/cart/opt/getCountiesByCityId.do?cityId="+e+"&callback=?";n="cart_county"}else if(3==a){var o="/cart/opt/getTownsByCountyId.do?countyId="+e+"&callback=?";n="cart_county"}t.getJSON(o,null,function(e){if(i(e)){for(var o="",r=0;r<e.data.length;r++)o+=1==a&&cart_city_id==e.data[r].id||2==a&&cart_county_id==e.data[r].id?'<dd value="'+e.data[r].id+'" class="on" data-val="'+e.data[r].name+'" name="'+n+'">'+e.data[r].name+"</dd>":'<dd value="'+e.data[r].id+'" data-val="'+e.data[r].name+'" name="'+n+'">'+e.data[r].name+"</dd>";1==a?t("#cart_city_area").html(o):2==a&&t("#cart_county_area").html(o),m(a)}})}function i(t){return t&&"00000000"==t.code}var o=this;o.isOpen=!1;var n=t(this).find(".address"),s=t(this).find(".tab_box"),c=t(this).find(".tabs span"),l=t(this).find(".area_box .item"),d=t(this).find(".val_text"),u=t(this).find(".close"),p={a:c.eq(0).attr("data-val")||"请选择省份",b:c.eq(1).attr("data-val")||"请选择市",c:c.eq(2).attr("data-val")||"请选择区"};n.off().click(function(){t(this).hasClass("select")?(t(this).removeClass("select"),s.hide(),o.isOpen=!1):(t(this).addClass("select"),s.show(),cart_county_id>0?(a(cart_city_id,2),m(2)):cart_city_id>0?(a(cart_province_id,1),m(1)):m(0),o.isOpen=!0)}),u.click(function(){e()}),t(document).click(function(a){if(o.isOpen){var i=t(a.target);0==i.parents(".mod_area_select").length&&e()}}),c.click(function(){var e=t(this).index();0==e?m(0):1==e?a(cart_province_id,1):2==e&&"请选择市"!=c.eq(1).find("em").html()&&a(cart_city_id,2)}),t(this).off().click(function(e){var i=t(e.target);if(i.is("dd")){var n=i.parents(".item");if(n.hasClass("first_area")){p.a=i.attr("data-val"),p.b="请选择市",p.c="请选择区";var r=t(i).attr("value");cart_province_id=r,cart_province_name=t(i).html(),m(1),a(r,1)}if(n.hasClass("second_area")){p.b=i.attr("data-val"),p.c="请选择区";var s=t(i).attr("value");cart_city_id=s,cart_city_name=t(i).html(),m(2),a(s,2)}if(n.hasClass("third_area")){p.c=i.attr("data-val");var c=t(i).attr("value");cart_county_id=c,cart_county_name=t(i).html(),h(),t(o).css({position:"relative",top:0}),t(o).find(".address").removeClass("select"),t(o).find(".tab_box").hide()}f(),n.find("dd").removeClass("on"),i.addClass("on")}});var m=function(t){c.eq(t).addClass("on").siblings().removeClass("on"),l.hide().eq(t).show()},h=function(){n.removeClass("select"),s.hide(),p.a=cart_province_name,p.b=cart_city_name;var e=p.a+"<i>|</i>"+p.b+"<i>|</i>"+p.c;d.html(e),f(),n.removeClass("select"),s.hide(),t("#cart_province_id").val()!=cart_province_id;var a=cart_province_id+"_"+cart_city_id+"_"+cart_county_id+"_0";t.cookie("provinceId",cart_province_id,{expires:365,path:"/",domain:".yhd.com"}),t.cookie("cityId",cart_city_id,{expires:365,path:"/",domain:".yhd.com"}),t.cookie("yhd_location",a,{expires:365,path:"/",domain:".yhd.com"}),t.cookie("ipLoc-djd",a,{expires:365,path:"/",domain:".yhd.com"}),r("cart_main_body").initMainBody(),r("cart_main_body").initPrismBar()},f=function(){c.eq(0).attr("data-val",p.a).find("em").html(p.a),c.eq(1).attr("data-val",p.b).find("em").html(p.b),c.eq(2).attr("data-val",p.c).find("em").html(p.c)}})},p.guessLikeScroll=function(){var e=t(".hot_sale_list");e.scrollPlugin({distance:"screen",viewDot:"dot"})},p.changeBuyScroll=function(){var e=t(".cheap_sale_list");e.scrollPlugin({distance:"screen",viewDot:"dot"})},p.columbBarScroll=function(){var e;e=t("body").hasClass("w980")?[{triggerDom:t(".single_sale_list"),distance:"single",viewDot:"false",showItem:9},{triggerDom:t(".seal_sale_list"),distance:"single",viewDot:"false",showItem:6},{triggerDom:t(".general_sale_list"),distance:"single",viewDot:"false",showItem:6}]:[{triggerDom:t(".single_sale_list"),distance:"single",viewDot:"false",showItem:11},{triggerDom:t(".seal_sale_list"),distance:"single",viewDot:"false",showItem:8},{triggerDom:t(".general_sale_list"),distance:"single",viewDot:"false",showItem:8}],t.each(e,function(){this.triggerDom.scrollPlugin({distance:this.distance,viewDot:this.viewDot,showItem:this.showItem})})},p.similarScroll=function(e){var a=t(e);a.scrollPlugin({distance:"screen",viewDot:"dot"})},p.makeupScroll=function(e){var a=t(e),i=0!=a.parents(".cart_shop_list").length||a.hasClass("makeup_list"),o=i?"dot":"false";a.scrollPlugin({distance:"screen",viewDot:o})},p.freeEvents=function(){function e(t){t.addClass("light").siblings().removeClass("light")}var a=t(".free_item"),i=t(".has_free");a.hover(function(){var a=t(this),i=t("#"+a.attr("data-activity"));a.toggleClass("light"),i.hasClass("light")?i.removeClass("light"):e(i)}).on("mouseover",".group_item",function(){t(this).addClass("hover")}).on("mouseout",".group_item",function(){t(this).removeClass("hover")}),i.hover(function(){var a=t(this),i=a.attr("id"),o=t('[data-activity="'+i+'"]');a.toggleClass("light"),o.hasClass("light")?o.removeClass("light"):e(o)})},p.initDialog=function(){function e(){t(".tip_dialog,.dialog").removeClass("slideUp"),t(".pay_tips,.popup_dialog,.makesure_dialog,.pay_tips").hide(),t(".tip_trigger").removeClass("down").parents().removeClass("down");var e=t(".c_global_toolbar"),a=t(".t_warp_slide_tabs .t_control_btn",e),i=t(".t_panel_content",e);e.removeClass("c_toolbar_open"),a.removeClass("t_btn_selected"),i.scrollTop(0)}t(".makeup_prod").hasClass("slideUp")||t(".tip_trigger").removeClass("down").parents().removeClass("down"),e(),t(document).click(function(a){var i=t(a.target);0==i.closest(".tip_dialog,.dialog,.popup_dialog,.pop_dialog,.pay_tips,.c_global_toolbar,.popup_mask,.checkout_btn,.similar_btn").length&&(s(!0),e())}),t(".close,.pop_close").on("click",function(){return e(),!1})},p.activityDroplist=function(){var e=t(".actvi_droplist");e.hover(function(){t(this).addClass("actvi_droplist_show")},function(){t(this).removeClass("actvi_droplist_show")}),e.find("li").on("click",function(){var e=t(this).parents(".main_item").data("identifier"),a=window.itemData[e],i=r("common"),o={type:"num",url:"/cart/opt/changePromotion.do?skuId="+a.sku.id+"&itemType="+a.itemType+"&num="+a.num+"&promotionId="+t(this).data("promotionId")+"&targetId="+a.promotionId,showMsg:!1,time:200};i.ajax(o),t(this).addClass("v_choose").siblings("li").removeClass("v_choose")})},p.tipDialog=function(){function e(t,e,a){a?a:a=t,e.hasClass("slideUp")?(e.removeClass("slideUp"),a.removeClass("down")):(p.initDialog(),e.addClass("slideUp"),a.addClass("down"))}p.tipShow=e,t(".coupon").off().on("mouseover",function(){return t(".popup_dialog").is(":visible")?!1:(t(this).children(".tag").addClass("down"),void t(this).find(".tip_dialog").addClass("slideUp"))}).on("mouseout",function(){t(this).children(".tag").removeClass("down"),t(this).find(".tip_dialog").removeClass("slideUp")}),t(".quick_makeup_btn").off().on("click",function(e){e.stopPropagation();var a=this,i=window.quickMakeup[t(a).data("promotionId")];t.ajax({url:"//pms.yhd.com/pms/getFullCutAddOnItems.do?callback=?",data:i.pmsdata,dataType:"jsonp",success:function(e){e&&e.value&&e.value.result.length?(e.value.displayName=i.displayName,t(".quick_makeup_dialog").html(n.template(t("#quick_makeup_dot").html())(e.value)),t(".quick_makeup_dialog .add_cart").off().on("click",function(){var e=t(this).data("pmId"),a=t(this).data("shoppingCount");r("cart_main_body").ajaxAddProductToCart(e,a)}),p.makeupScroll(".makeup_list"),p.initDialog(),t(this).PopupDialog({popupClass:".quick_makeup_dialog",maskLayer:!1,callback:function(){t(".coupon").hover(function(){return!1})}})):p.alert("暂无推荐商品",2)}})})},p.alert=function(t,e){p.dialog({tit:"disabled",txt:t,cancel:"disabled",delayClose:e,maskLayer:!1})},p.prodHover=function(){t(".sale_item").unbind("mouseenter mouseleave").each(function(){var e=t(this),a=e.find(".add_shopcart");e.hover(function(){a.addClass("add_shopcart_show").hover(function(){a.removeClass("as_icon_show").addClass("as_txt_show")},function(){a.removeClass("as_txt_show").addClass("as_icon_show")})},function(){a.removeClass("add_shopcart_show")})}),t(".cart_item .item").unbind("mouseenter mouseleave").hover(function(){t(this).parents("ul").hasClass("unable")||t(this).toggleClass("cur")}),t(".makeup_prod .tab").find("li").on("click",function(){t(this).addClass("cur").siblings("li").removeClass("cur")})},p.columnBar=function(){function e(t,e,a){if(a.hasClass(t)){e.show();var i=e.outerHeight(!0)-10;n.hasClass("tools_bar_top")?o.down(e):n.hasClass("tools_bar_bottom")?o.up(e,i):c-u>d/2?o.up(e,i):o.down(e)
}}function a(e){var a=c+r-d,i=t(".rpt_detail"),o=/msie\s+[5-6]\./i.test(window.navigator.userAgent),s=t(".popup_dialog"),l=t(".tip_dialog"),p=t(".dialog");if(m>=e&&a>0){s.removeClass("pop_zIndexMore"),l.removeClass("pop_zIndexMore"),p.removeClass("pop_zIndexMore"),n.addClass("tools_bar_bottom").removeClass("tools_bar_top"),i.addClass("arrow_turn").removeClass("arrow_restore");var h=u+d-r;o&&t(".tools_bar_bottom").css({top:h})}else e>=c?(s.removeClass("pop_zIndexMore"),l.removeClass("pop_zIndexMore"),p.removeClass("pop_zIndexMore"),n.addClass("tools_bar_top").removeClass("tools_bar_bottom"),i.addClass("arrow_restore").removeClass("arrow_turn"),o&&t(".tools_bar_top").css({top:u})):(s.addClass("pop_zIndexMore"),l.addClass("pop_zIndexMore"),p.addClass("pop_zIndexMore"),n.removeClass("tools_bar_top tools_bar_bottom"),c-u>d/2?i.addClass("arrow_turn").removeClass("arrow_restore"):i.addClass("arrow_restore").removeClass("arrow_turn"),o&&n.css({top:0}))}function i(e,a){var i=Math.ceil(a.innerWidth()),o=e.width(),n=e.offset().left,r=t("body").width(),s=e.parents(".pay_tools_inner").width()-2,c=a.find(".t_arrow");if(i==s){var l=n-r/2+o/2;c.css("marginLeft",l)}else{var d=r/2-n+(i-o)/2+4;a.css("marginLeft",-d)}}if(t(".pay_tools_bar").length){var o,n=t(".pay_tools_bar"),r=n.outerHeight(!0),c=n.offset().top,l=t(window),d=l.outerHeight(!0),u=l.scrollTop(),m=Math.abs(c-d)+r,h=t(".pay_tips"),f=t(".r_price_total"),v=t(".r_prod_view");o={up:function(t,e){var a=e+8;t.css({top:-e}).find(".t_arrow").removeClass("t_arrow_top").addClass("t_arrow_bot").css({top:a})},down:function(t){var e="50px",a="-8px";t.css({top:e}).find(".t_arrow").removeClass("t_arrow_bot").addClass("t_arrow_top").css({top:a})}},a(u),l.on("scroll",function(){d=l.outerHeight(!0),u=l.scrollTop(),a(u),g.is(":visible")?(_.hide(),e("r_price_total",g,f)):_.is(":visible")&&(g.hide(),e("r_prod_view",_,v))});var g=(t(".r_control_tip"),t(".pay_total_tips")),_=t(".pay_allprod_tips"),b=t(".pay_free_tips");t(".lt_free").off().on("click",function(a){a.stopPropagation();var o=t(this);u=l.scrollTop();var n=b.is(":visible");n?b.hide():(p.initDialog(),e("lt_free",b,o),i(o,b))}),t(".r_price_total").on("mouseenter",function(a){a.stopPropagation();var i=t(this),o=t(".pay_tips").is(":visible");return o?!1:(u=l.scrollTop(),h.hide(),e("r_price_total",g,i),void g.on("mouseover",function(){t(this).show()}).on("mouseout",function(){t(this).hide()}))}).on("mouseleave",function(){g.hide()}),t(".r_prod_view").off().on("click",function(a){if(t(".pvw").is(":visible")&&(a.stopPropagation(),"1"!=t("#isMedicine").val())){var o=t(this);t("#checkoutGroups").val()>1&&s(!1),e("r_prod_view",_,o),i(o,_),t(".pvw_sale_list").find(".sale_item").unbind("mouseenter mouseleave"),t(".pvw_sale_list").find(".sale_item").hover(function(){t(this).toggleClass("cur")}),p.columbBarScroll()}})}},p.initPopChat=function(){function e(){return yhdPublicLogin.getCookie("pin")?!0:!1}var a=t(".cart_tit.clearfix").map(function(){return"8888"!=t(this).data("merchantId")?t(this).data("merchantId"):void 0}).get().join(",");t.ajax({url:"//chat1.jd.com/api/checkChat",data:{venderList:a,random:Math.random()},jsonpCallback:"jQuery"+t.now(),type:"get",dataType:"jsonp",error:function(){},success:function(e){for(var a=0;a<e.length;a++)"1"!=e[a].code&&t("#"+e[a].venderId).addClass("unable")}}),t(".btn-im").on("click",function(t){e()||(t.preventDefault(),yhdPublicLogin.showLoginDiv("",!1,"2"))})},p.check=function(){function e(t){var e=r("common"),a={url:t,showMsg:!1,time:200};e.ajax(a)}t(".check,.checkbox").off().on("click",function(a){a.stopPropagation(),p.initDialog();var i;i=t(this).hasClass("checkbox")?t(this).find(".check"):t(this);var o,n=i.data("checkType"),r=1==n,s=i.hasClass("check_all"),c=i.hasClass("check_list"),l=i.hasClass("check_activity"),d=i.hasClass("check_item");if(2!=n)if(d){var u=t(this).parents(".main_item").data("identifier"),m=window.itemData[u],h=4==m.itemType?m.promotionId:m.sku.id,f=m.itemType,v=m.promotionId?m.promotionId:0;if(r){var g="/cart/opt/uncheckItem.do?skuId="+h+"&ptype="+f+"&targetId="+v+"&callback=?";e(g),i.removeClass("checked")}else{var g="/cart/opt/checkItem.do?skuId="+h+"&ptype="+f+"&targetId="+v+"&callback=?";e(g),i.addClass("checked")}}else if(s)if(r){var g="/cart/opt/uncheckAllItems.do?&callback=?";e(g),i.removeClass("checked")}else{var g="/cart/opt/checkAllItems.do?&callback=?";e(g),i.addClass("checked")}else if(c||l){o=c?t(this).parents(".cart_list").find(".check_item"):t(this).parents(".activity").find(".check_item");var _=0,b=t(o).map(function(){var e=t(this).parents(".main_item").data("identifier");m=window.itemData[e];var a=4==m.itemType?m.promotionId:m.sku.id,i=m.itemType,o=m.promotionId?m.promotionId:0,n="skuItems["+_++ +"]";return n+".itemId="+a+"&"+n+".itemType="+i+"&"+n+".targetId="+o}).get().join("&");if(r){var g="/cart/opt/uncheckItems.do?"+b+"&callback=?";e(g),o.removeClass("checked")}else{var g="/cart/opt/checkItems.do?"+b+"&callback=?";e(g),o.addClass("checked")}}}),window.ajaxFun=e},p.toolbar=function(){function e(){t(window).scroll(function(){a=t(window).scrollTop(),i.css("top",a)})}var a,i=(t("body"),t(".c_global_toolbar")),n=t(".t_warp_slide_tabs .t_control_btn",i),s=t(".t_panel_content",i),c=s.find(".delete_all"),l=i.find(".tbar_slide_close"),d="undefined"==typeof document.body.style.maxHeight;d?e():"",n.on("click",function(e){e.stopPropagation();var a=t(this),o=a.attr("data-value"),n=i.find(".t_panel_content[data-value="+o+"]");a.hasClass("t_btn_selected")?p.initDialog():(a.addClass("t_btn_selected").siblings().removeClass("t_btn_selected"),n.removeClass("toolbar-animate-out").addClass("t_panel_content_show  toolbar-animate-in").siblings().removeClass("toolbar-animate-in t_panel_content_show").addClass("toolbar-animate-out"),s.find(".t_panel_wrap").scrollTop(0),i.hasClass("c_toolbar_open")||i.addClass("c_toolbar_open"))}),l.on("click",function(t){t.stopPropagation(),p.initDialog()}),t(".check,.checkbox").on("click",function(t){t.stopPropagation(),p.initDialog()}),c.click(function(t){t.stopPropagation(),i.find(".tbar_mask_layout").show(),i.find(".del_list_dialog").show()}),t(".close_btn,.sure_btn",i).click(function(e){if(e.stopPropagation(),i.find(".tbar_mask_layout").hide(),i.find(".del_list_dialog").hide(),t(this).hasClass("sure_btn")){var a="/cart/opt/clearRecycleBin.do?callback=?";t.getJSON(a,function(e){if(o.isReqSuccess(e)){var a=r("doT").template(t("#recycler_dot").html())({});t(".t_panel_cont_recycler").find(".t_panel_wrap").html(a),t(".t_warp_slide_tabs").find("#trash").find(".c_lit_tip").html(0),t(c).hide()}})}})},p.otherJs=function(){t.fn.extend({preventScroll:function(){t(this).each(function(){var t=this;navigator.userAgent.indexOf("Firefox")>=0?t.addEventListener("DOMMouseScroll",function(e){t.scrollTop+=e.detail>0?10:-10,e.preventDefault()},!1):t.onmousewheel=function(e){return e=e||window.event,t.scrollTop+=e.wheelDelta>0?-10:10,!1}})}}),t(".t_panel_wrap").preventScroll(),t(".coupon_dialog_wrap").preventScroll(),t(".pay_allprod_tips").preventScroll()},p.columnBarArrow=function(){var e=t(".r_prod_view"),a=t(".pay_allprod_tips");if(e&&a&&e.offset()){var i=a.find(".t_arrow"),o=e.width(),n=(a.width(),e.offset().left),r=t("body").width(),s=n-r/2+o/2;i.css("marginLeft",s)}},p.animateAdd=function(){t(".tp_add_cart").on("click",function(){var e=t(this),a=e.data("pmInfoId"),i=t("li[data-pmInfoId="+a+"]");t("html, body").animate({scrollTop:i.offset().top},300,function(){setTimeout(function(){i.find(".item").last().slideDown(300),p.initClass()},300)})})},p.setCheckOutButtonStatus=s,p.flyItem=document.getElementById("flyItem"),p.flagMoving=!1,p.animateParabola=function(e,a){function i(){var e=1==o.parents("ul").children("li.item").length;t(p.flyItem).fadeOut(300),o.slideUp(300),e&&!n&&o.parents("ul").slideUp(300),setTimeout(function(){e&&!n&&o.parents("ul").remove(),o.remove(),p.initClass()},300),t(a).find(".add_tip").fadeIn(300),t(a).parents(".t_control_btn").addClass("has_tip"),p.flagMoving=!1,setTimeout(function(){t(a).find(".add_tip").fadeOut(500),t(a).parents(".t_control_btn").removeClass("has_tip")},1e3)}if(1==p.flagMoving)return!1;p.flagMoving=!0;{var o,n=t(e).parents(".cart_prod").hasClass("yanbao"),r=t(e).parents("ul").hasClass("unable");parseInt(t(a).find("b").html())}o=t(e).parents(n?".cart_prod":r?"ul":"li");var s=o.width(),c=o.height(),l=o.offset().top+c/2-25,d=o.offset().left+s/2,u=50/o.outerWidth(!0),m=50/o.outerHeight(!0),h=o.find(".item_pic").first().children("img"),f=h.attr("src");o.css({transform:"scaleX("+u+") scaleY("+m+")",transition:"transform ease .5s"}),setTimeout(function(){o.css("opacity",0),t(p.flyItem).show().css({top:l,left:d}).find("img").attr("src",f),v.position().move()},500);var v=funParabola(p.flyItem,a,{speed:200,curvature:.0012,complete:function(){i()}})},p.dialog=function(e){p.initDialog();var a={tit:"确认",txt:"确认执行此操作吗?",cancel:"取消",confirm:"确定",maskLayer:!0,delayClose:null,callback:function(){}},e=t.extend(!0,a,e),i=t(".pop_dialog.common");"disabled"===e.tit?i.find(".tit").hide():i.find(".tit").show(),"disabled"===e.txt?i.find(".txt").hide():i.find(".txt").show(),"disabled"===e.cancel?i.find(".cancel").hide():i.find(".cancel").show(),"disabled"===e.confirm?i.find(".confirm").hide():i.find(".confirm").show(),i.find(".tit").html(e.tit),i.find(".txt").html(e.txt),i.find(".cancel").html(e.cancel),i.find(".config").html(e.confirm),e.maskLayer?i.removeClass("tip_dialog"):i.addClass("tip_dialog"),i.PopupDialog({popupClass:".pop_dialog.common",maskLayer:e.maskLayer,delayClose:e.delayClose,callback:e.callback})},p.warning=function(e){p.initDialog(),$dialog=t(".pop_dialog.warn_pop"),t(".pop_dialog.warn_pop").PopupDialog({popupClass:".pop_dialog.warn_pop",callback:e.callback,cancelCallback:e.cancelCallback})},p}),define("common",["jquery","newCart","utils"],function(t,e,a){function i(){var t=0;this.entry=[],this.put=function(e,a){this.containsKey(e)||t++,this.entry[e]=a},this.get=function(t){return this.containsKey(t)?this.entry[t]:null},this.remove=function(e){delete this.entry[e]&&t--},this.containsKey=function(t){return t in this.entry},this.containsValue=function(t){for(var e in this.entry)if(this.entry[e]==t)return!0;return!1},this.values=function(){var e=new Array(t);for(var a in this.entry)e.push(this.entry[a]);return e},this.keys=function(){var e=new Array(t);for(var a in this.entry)e.push(a);return e},this.size=function(){return t},this.clear=function(){this.entry=[],this.size=0}}var o={};o.reqSucceed=function(t){if(t&&t.code&&t.code.length>=8){if("00000000"==t.code||"00000001"==t.code)return!0;var a=t.code.substring(0,3),i=t.code.substring(t.code.length-5,t.code.length);return"300"==a&&"00001"==i?(r.confirmFlag?yhdPublicLogin.showLoginDivNone("",!1,"",r.confirm,2):yhdPublicLogin.showLoginDiv("",!1,"2"),!1):(e.dialog({tit:"温馨提示",txt:t.msg,cancel:"disabled",confirm:"确定",delayClose:null,callback:function(){var e=!1;"50000019"==t.code&&(e=!0),t.msg&&!t.msg.indexOf("系统繁忙")&&(e=!0),e&&require("cart_main_body").initMainBody()}}),!1)}return e.dialog({tit:"系统繁忙",txt:"disabled",cancel:"disabled",confirm:"确定",delayClose:null,callback:function(){require("cart_main_body").initMainBody()}}),!1};var n={};n.map=new i,n.mergeSelect=function(){var t=!0;for(var e in this.map.entry){var a=this.map.get(e);if(null!=a&&1==a.stage){a.clearTimeout(),a.setTimeout(),t=!1;break}}return t},n.mergeDelete=function(){var t=!0;for(var e in this.map.entry){var a=this.map.get(e);null!=a&&1==a.stage&&("select"==a.type&&(a.clearTimeout(),n.map.remove(e)),"delete"==a.type&&(a.addDeletePost(options),a.clearTimeout(),a.setTimeout(),t=!1))}return t},n.mergeNum=function(t){var e=!0;for(var a in this.map.entry){var i=this.map.get(a);null!=i&&1==i.stage&&("view"==i.type&&(i.clearTimeout(),n.map.remove(a)),"num"==i.type&&i.productId==t.productId&&(i.url=t.url,i.clearTimeout(),i.setTimeout(),e=!1))}return e},n.mergeLandingNum=function(t){var e=!0;for(var a in this.map.entry){var i=this.map.get(a);null!=i&&1==i.stage&&("view"==i.type&&(i.clearTimeout(),n.map.remove(a)),"landingNum"==i.type&&i.productId==t.productId&&i.merchantId==t.merchantId&&i.promotionId==t.promotionId&&(i.url=t.url,i.clearTimeout(),i.setTimeout(),e=!1))}return e},n.mergePointProdNum=function(t){var e=!0;for(var a in this.map.entry){var i=this.map.get(a);null!=i&&1==i.stage&&("view"==i.type&&(i.clearTimeout(),n.map.remove(a)),"pointProdNum"==i.type&&i.productId==t.productId&&i.merchantId==t.merchantId&&(i.url=t.url,i.clearTimeout(),i.setTimeout(),e=!1))}return e},n.mergeGoldProdNum=function(t){var e=!0;for(var a in this.map.entry){var i=this.map.get(a);null!=i&&1==i.stage&&("view"==i.type&&(i.clearTimeout(),n.map.remove(a)),"goldProdNum"==i.type&&i.productId==t.productId&&i.merchantId==t.merchantId&&(i.url=t.url,i.clearTimeout(),i.setTimeout(),e=!1))}return e},n.mergeCombineNum=function(t){var e=!0;for(var a in this.map.entry){var i=this.map.get(a);null!=i&&1==i.stage&&("view"==i.type&&(i.clearTimeout(),n.map.remove(a)),"combineNum"==i.type&&i.cartItemVoId==t.cartItemVoId&&(i.url=t.url,i.clearTimeout(),i.setTimeout(),e=!1))}return e},n.mergeOther=function(){for(var t in this.map.entry){var e=this.map.get(t);null!=e&&1==e.stage&&"select"==e.type&&(e.clearTimeout(),n.map.remove(t))}return!0},n.mergeReq=function(t){t.type=t.type||"other";var e=t.type;if(!r.confirmFlag||"check"==e){if(this.map.size<=0)return void this.buildReq(t);var a=!0;"select"==e&&(a=this.mergeSelect()),"delete"==e&&(a=this.mergeDelete(t)),"num"==e&&(a=this.mergeNum(t)),"landingNum"==e&&(a=this.mergeLandingNum(t)),"pointProdNum"==e&&(a=this.mergePointProdNum(t)),"goldProdNum"==e&&(a=this.mergeGoldProdNum(t)),"combineNum"==e&&(a=this.mergeCombineNum(t)),"other"==e&&(a=this.mergeOther()),a&&this.buildReq(t)}},n.buildReq=function(e){var o={};o.success=e.success,o.type=e.type,o.url=e.url,o.showMsg=e.showMsg,o.stage=0,o.timer=null;var n=e.type;"num"==n?(o.productId=e.productId,o.merchantId=e.merchantId):"landingNum"==n?(o.productId=e.productId,o.merchantId=e.merchantId,o.promotionId=e.promotionId):"pointProdNum"==n?(o.productId=e.productId,o.merchantId=e.merchantId):"goldProdNum"==n?(o.productId=e.productId,o.merchantId=e.merchantId):"combineNum"==n&&(o.cartItemVoId=e.cartItemVoId),"delete"==n&&(o.deleteRecord=new i,e.deleteId&&o.deleteRecord.put(e.deleteId,1),o.deleteId=[],o.deletePromo=[],o.addDeletePost=function(t){switch(t.deleteType){case 0:this.deleteId.push(t.deleteId);break;case 1:this.deletePromo.push(t.deleteId)}return this.deleteRecord.put(t.deleteId,1),!0},o.addDeletePost(e)),o.getParam=function(){var e=(t("#currentCheckoutType").val(),null);if(e=t(".check_item").map(function(){return t(this).data("check-str")+"="+(t(this).hasClass("checked")?"1":"0")}).get().join(","),"delete"==this.type){var i={deleteId:this.deleteId.join(","),deletePromo:this.deletePromo.join(","),logged:a.getUserLoggedInPage(),view:r.length<=0&&!r.confirmFlag?1:0,isMedicine:t("#isMedicine").val()};return i}return{logged:a.getUserLoggedInPage(),view:r.length<=0&&!r.confirmFlag?1:0,isMedicine:t("#isMedicine").val()}},o.getUrl=function(){return this.url},o.post=function(){r.add(this)},o.setTimeout=function(){this.timer=setTimeout(function(){o.post()},!e.time||e.time<0?0:e.time),this.stage=1},o.clearTimeout=function(){this.timer&&clearTimeout(this.timer),this.stage=0},"check"==o.type?r.add(o):o.setTimeout(),this.map.put(o.timer,o)},o.reloadDelete=function(){t(".del_btn").each(function(){for(var e in n.map.entry){var a=n.map.get(e);null!=a&&"delete"==a.type&&a.stage<3&&a.deleteRecord.containsKey(t(this).data("deleteId"))&&t(this).parents(".item_line").remove()}})},n.anyTimeout=function(){for(var t in this.map.entry){var e=this.map.get(t);if(e&&1==e.stage)return!0}return!1};var r=[];return r.workingFlag=!1,r.confirmFlag=!1,r.showBlockUI=!1,r.timeup=!1,r.go=function(){if(!r.workingFlag){if(r.timeup=!1,r.workingFlag=!0,r.length<=0)return r.workingFlag=!1,void(r.confirmFlag&&!n.anyTimeout()&&(r.confirmFlag=!1,o.unblockUI(!1),t(".check_item.checked").length&&require("checkOut").goCheckout()));var e=r.shift();if(null==e.type||""==e.type)return e.stage=3,n.map.remove(e.timer),r.workingFlag=!1,void r.go();r.confirmFlag||"other"!=e.type||o.blockUI(),t.getJSON(e.getUrl(),e.getParam(),function(t){return r.timeup?!1:(e.stage=3,n.map.remove(e.timer),r.workingFlag=!1,void(o.reqSucceed(t)?(e.success&&e.success(t),r.showBlockUI=r.showBlockUI||e.showMsg,!r.confirmFlag&&r.length<=0?(o.unblockUI(r.showBlockUI),require("cart_main_body").refreshMainBody(t)):r.go()):(o.unblockUI(!1),r.confirmFlag&&(r.confirmFlag=!1),r.length=0)))})}},r.add=function(t){r.confirmFlag&&"check"!=t.type||(t.stage=2,r.push(t),r.go())},r.confirm=function(){o.blockUI(),r.confirmFlag=!0;var t="/cart/mod/checkBC.do?callback=?";n.mergeReq({type:"check",url:t,showMsg:!1})},o.go2CheckOut=r.confirm,o=t.extend(o,{isBlocked:!1,ajax:function(t){n.mergeReq(t)},blockUI:function(){o.isBlocked||(o.isBlocked=!0,t(this).PopupDialog({popupClass:".loading_pop",maskLayer:!1}))},unblockUI:function(){o.isBlocked=!1,t(".pop_dialog.loading_pop").hide()}})}),function(){function t(t){function e(e,i){var n,f,v=e==window,g=i&&void 0!==i.message?i.message:void 0;if(i=t.extend({},t.blockUI.defaults,i||{}),!i.ignoreIfBlocked||!t(e).data("blockUI.isBlocked")){if(i.overlayCSS=t.extend({},t.blockUI.defaults.overlayCSS,i.overlayCSS||{}),n=t.extend({},t.blockUI.defaults.css,i.css||{}),i.onOverlayClick&&(i.overlayCSS.cursor="pointer"),f=t.extend({},t.blockUI.defaults.themedCSS,i.themedCSS||{}),g=void 0===g?i.message:g,v&&m&&a(window,{fadeOut:0}),g&&"string"!=typeof g&&(g.parentNode||g.jquery)){var _=g.jquery?g[0]:g,b={};t(e).data("blockUI.history",b),b.el=_,b.parent=_.parentNode,b.display=_.style.display,b.position=_.style.position,b.parent&&b.parent.removeChild(_)}t(e).data("blockUI.onUnblock",i.onUnblock);var y,k,w,C,I=i.baseZ;y=t(d||i.forceIframe?'<iframe class="blockUI" style="z-index:'+I++ +';display:none;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0" src="'+i.iframeSrc+'"></iframe>':'<div class="blockUI" style="display:none"></div>'),k=t(i.theme?'<div class="blockUI blockOverlay ui-widget-overlay" style="z-index:'+I++ +';display:none"></div>':'<div class="blockUI blockOverlay" style="z-index:'+I++ +';display:none;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0"></div>'),i.theme&&v?(C='<div class="blockUI '+i.blockMsgClass+' blockPage ui-dialog ui-widget ui-corner-all" style="z-index:'+(I+10)+';display:none;position:fixed">',i.title&&(C+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(i.title||"&nbsp;")+"</div>"),C+='<div class="ui-widget-content ui-dialog-content"></div>',C+="</div>"):i.theme?(C='<div class="blockUI '+i.blockMsgClass+' blockElement ui-dialog ui-widget ui-corner-all" style="z-index:'+(I+10)+';display:none;position:absolute">',i.title&&(C+='<div class="ui-widget-header ui-dialog-titlebar ui-corner-all blockTitle">'+(i.title||"&nbsp;")+"</div>"),C+='<div class="ui-widget-content ui-dialog-content"></div>',C+="</div>"):C=v?'<div class="blockUI '+i.blockMsgClass+' blockPage" style="z-index:'+(I+10)+';display:none;position:fixed"></div>':'<div class="blockUI '+i.blockMsgClass+' blockElement" style="z-index:'+(I+10)+';display:none;position:absolute"></div>',w=t(C),g&&(i.theme?(w.css(f),w.addClass("ui-widget-content")):w.css(n)),i.theme||k.css(i.overlayCSS),k.css("position",v?"fixed":"absolute"),(d||i.forceIframe)&&y.css("opacity",0);var $=[y,k,w],x=t(v?"body":e);t.each($,function(){this.appendTo(x)}),i.theme&&i.draggable&&t.fn.draggable&&w.draggable({handle:".ui-dialog-titlebar",cancel:"li"});var T=p&&(!t.support.boxModel||t("object,embed",v?null:e).length>0);if(u||T){if(v&&i.allowBodyStretch&&t.support.boxModel&&t("html,body").css("height","100%"),(u||!t.support.boxModel)&&!v)var N=c(e,"borderTopWidth"),S=c(e,"borderLeftWidth"),j=N?"(0 - "+N+")":0,P=S?"(0 - "+S+")":0;t.each($,function(t,e){var a=e[0].style;if(a.position="absolute",2>t)v?a.setExpression("height","Math.max(document.body.scrollHeight, document.body.offsetHeight) - (jQuery.support.boxModel?0:"+i.quirksmodeOffsetHack+') + "px"'):a.setExpression("height",'this.parentNode.offsetHeight + "px"'),v?a.setExpression("width",'jQuery.support.boxModel && document.documentElement.clientWidth || document.body.clientWidth + "px"'):a.setExpression("width",'this.parentNode.offsetWidth + "px"'),P&&a.setExpression("left",P),j&&a.setExpression("top",j);else if(i.centerY)v&&a.setExpression("top",'(document.documentElement.clientHeight || document.body.clientHeight) / 2 - (this.offsetHeight / 2) + (blah = document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "px"'),a.marginTop=0;else if(!i.centerY&&v){var o=i.css&&i.css.top?parseInt(i.css.top,10):0,n="((document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop) + "+o+') + "px"';a.setExpression("top",n)}})}if(g&&(i.theme?w.find(".ui-widget-content").append(g):w.append(g),(g.jquery||g.nodeType)&&t(g).show()),(d||i.forceIframe)&&i.showOverlay&&y.show(),i.fadeIn){var M=i.onBlock?i.onBlock:l,D=i.showOverlay&&!g?M:l,L=g?M:l;i.showOverlay&&k._fadeIn(i.fadeIn,D),g&&w._fadeIn(i.fadeIn,L)}else i.showOverlay&&k.show(),g&&w.show(),i.onBlock&&i.onBlock.bind(w)();if(o(1,e,i),v?(m=w[0],h=t(i.focusableElements,m),i.focusInput&&setTimeout(r,20)):s(w[0],i.centerX,i.centerY),i.timeout){var U=setTimeout(function(){v?t.unblockUI(i):t(e).unblock(i)},i.timeout);t(e).data("blockUI.timeout",U)}}}function a(e,a){var n,r=e==window,s=t(e),c=s.data("blockUI.history"),l=s.data("blockUI.timeout");l&&(clearTimeout(l),s.removeData("blockUI.timeout")),a=t.extend({},t.blockUI.defaults,a||{}),o(0,e,a),null===a.onUnblock&&(a.onUnblock=s.data("blockUI.onUnblock"),s.removeData("blockUI.onUnblock"));var d;d=r?t("body").children().filter(".blockUI").add("body > .blockUI"):s.find(">.blockUI"),a.cursorReset&&(d.length>1&&(d[1].style.cursor=a.cursorReset),d.length>2&&(d[2].style.cursor=a.cursorReset)),r&&(m=h=null),a.fadeOut?(n=d.length,d.stop().fadeOut(a.fadeOut,function(){0===--n&&i(d,c,a,e)})):i(d,c,a,e)}function i(e,a,i,o){var n=t(o);if(!n.data("blockUI.isBlocked")){e.each(function(){this.parentNode&&this.parentNode.removeChild(this)}),a&&a.el&&(a.el.style.display=a.display,a.el.style.position=a.position,a.el.style.cursor="default",a.parent&&a.parent.appendChild(a.el),n.removeData("blockUI.history")),n.data("blockUI.static")&&n.css("position","static"),"function"==typeof i.onUnblock&&i.onUnblock(o,i);var r=t(document.body),s=r.width(),c=r[0].style.width;r.width(s-1).width(s),r[0].style.width=c}}function o(e,a,i){var o=a==window,r=t(a);if((e||(!o||m)&&(o||r.data("blockUI.isBlocked")))&&(r.data("blockUI.isBlocked",e),o&&i.bindEvents&&(!e||i.showOverlay))){var s="mousedown mouseup keydown keypress keyup touchstart touchend touchmove";e?t(document).bind(s,i,n):t(document).unbind(s,n)}}function n(e){if("keydown"===e.type&&e.keyCode&&9==e.keyCode&&m&&e.data.constrainTabKey){var a=h,i=!e.shiftKey&&e.target===a[a.length-1],o=e.shiftKey&&e.target===a[0];if(i||o)return setTimeout(function(){r(o)},10),!1}var n=e.data,s=t(e.target);return s.hasClass("blockOverlay")&&n.onOverlayClick&&n.onOverlayClick(e),s.parents("div."+n.blockMsgClass).length>0?!0:0===s.parents().children().filter("div.blockUI").length}function r(t){if(h){var e=h[t===!0?h.length-1:0];e&&e.focus()}}function s(t,e,a){var i=t.parentNode,o=t.style,n=(i.offsetWidth-t.offsetWidth)/2-c(i,"borderLeftWidth"),r=(i.offsetHeight-t.offsetHeight)/2-c(i,"borderTopWidth");e&&(o.left=n>0?n+"px":"0"),a&&(o.top=r>0?r+"px":"0")}function c(e,a){return parseInt(t.css(e,a),10)||0}t.fn._fadeIn=t.fn.fadeIn;var l=t.noop||function(){},d=/MSIE/.test(navigator.userAgent),u=/MSIE 6.0/.test(navigator.userAgent)&&!/MSIE 8.0/.test(navigator.userAgent),p=(document.documentMode||0,t.isFunction(document.createElement("div").style.setExpression));t.blockUI=function(t){e(window,t)},t.unblockUI=function(t){a(window,t)},t.growlUI=function(e,a,i,o){var n=t('<div class="growlUI"></div>');e&&n.append("<h1>"+e+"</h1>"),a&&n.append("<h2>"+a+"</h2>"),void 0===i&&(i=3e3);var r=function(e){e=e||{},t.blockUI({message:n,fadeIn:"undefined"!=typeof e.fadeIn?e.fadeIn:700,fadeOut:"undefined"!=typeof e.fadeOut?e.fadeOut:1e3,timeout:"undefined"!=typeof e.timeout?e.timeout:i,centerY:!1,showOverlay:!1,onUnblock:o,css:t.blockUI.defaults.growlCSS})};r();n.css("opacity");n.mouseover(function(){r({fadeIn:0,timeout:3e4});var e=t(".blockMsg");e.stop(),e.fadeTo(300,1)}).mouseout(function(){t(".blockMsg").fadeOut(1e3)})},t.fn.block=function(a){if(this[0]===window)return t.blockUI(a),this;var i=t.extend({},t.blockUI.defaults,a||{});return this.each(function(){var e=t(this);i.ignoreIfBlocked&&e.data("blockUI.isBlocked")||e.unblock({fadeOut:0})}),this.each(function(){"static"==t.css(this,"position")&&(this.style.position="relative",t(this).data("blockUI.static",!0)),this.style.zoom=1,e(this,a)})},t.fn.unblock=function(e){return this[0]===window?(t.unblockUI(e),this):this.each(function(){a(this,e)})},t.blockUI.version=2.7,t.blockUI.defaults={message:"<h1>Please wait...</h1>",title:null,draggable:!0,theme:!1,css:{padding:0,margin:0,width:"30%",top:"40%",left:"35%",textAlign:"center",color:"#000",border:"3px solid #aaa",backgroundColor:"#fff",cursor:"wait"},themedCSS:{width:"30%",top:"40%",left:"35%"},overlayCSS:{backgroundColor:"#000",opacity:.6,cursor:"wait"},cursorReset:"default",growlCSS:{width:"350px",top:"10px",left:"",right:"10px",border:"none",padding:"5px",opacity:.6,cursor:"default",color:"#fff",backgroundColor:"#000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"},iframeSrc:/^https/i.test(window.location.href||"")?"javascript:false":"about:blank",forceIframe:!1,baseZ:1e3,centerX:!0,centerY:!0,allowBodyStretch:!0,bindEvents:!0,constrainTabKey:!0,fadeIn:200,fadeOut:400,timeout:0,showOverlay:!0,focusInput:!0,focusableElements:":input:enabled:visible",onBlock:null,onUnblock:null,onOverlayClick:null,quirksmodeOffsetHack:4,blockMsgClass:"blockMsg",ignoreIfBlocked:!1};var m=null,h=[]}"function"==typeof define&&define.amd&&define.amd.jQuery?define("blockUI",["jquery"],t):t(jQuery)}();var webIM={_positionId:5,_mcsite:3,_domain:"//webim.yhd.com",show1mallIM:function(){var t=0;jQuery("[class=show1mallIM][setted=false]").each(function(){var e=$(this),a=e.attr("value"),i="/interface/show_qq_info_lite.action?r="+Math.random()+"&merchantId="+a+"&position=0&limPage=1&limType=small&type=html&jsonpCallback=?";jQuery.getJSON(i,function(a){if(0==a.code&&(e.html(a.msg),0==t)){t=1;var i=$("<link/>");$(i).attr("type","text/css"),$(i).attr("rel","stylesheet"),i.attr("href",a.cssFile),$("head").append(i);var o=document.createElement("script");o.type="text/javascript",o.src=a.jsFile,document.getElementsByTagName("head")[0].appendChild(o)}})})},requestNewWebIM:function(){var t=this,e=0;$(".show1mallIM").each(function(){var a=$(this),i=a.data("merchantId"),o=t._domain+"/checkPoint/showPoint/"+i+"/"+t._positionId+"/0/0/"+t._mcsite+".action",n="?iconType=small&jsonpCallback=?";jQuery.getJSON(o+n,function(i){if(i&&isNaN(i)){var o="";if(0==e)e=1,o=i;else{var n=jQuery(i).find("#onlineChatSpan");o=n.length>0?n:i}a.html(o)}else a.attr("setted",!1),t.show1mallIM()})})}};"function"==typeof define&&define.amd&&define("WebIM",[],function(){return webIM}),function(t){t.fn.countdown=function(e){function a(t){this.element=t,this.init()}return a.prototype={init:function(){this.options=t.extend({},e||{}),this.time=null,this.endTime=new Date(this.options.endTime?this.options.endTime:(new Date).getTime()+(this.options.time||0)),this.updateTime(this)},getTimes:function(t,e,a){var i=new Date,o=t.endTime;t.t=o-i,t.h=Math.floor(t.t/1e3/60/60%24),t.m=Math.floor(t.t/1e3/60%60),t.s=Math.floor(t.t/1e3%60),o>i?"function"==typeof e&&e(t.element,t.h>9?t.h:"0"+t.h,t.m>9?t.m:"0"+t.m,t.s>9?t.s:"0"+t.s):(clearInterval(t.time),"function"==typeof a&&a())},updateTime:function(t){t.time=setInterval(function(){t.getTimes(t,t.options.onTick,t.options.onExpiry)},1e3)}},this.each(function(){new a(t(this),e)})}}(jQuery),define("countdown",function(){}),define("cart_main_body",["jquery","dotdotdot","common","doT","blockUI","newCart","utils","WebIM","countdown"],function($,dotdotdot,common,doT,blockUI,newCart,utils,webIM,countdown){function calSubTotal(t){var e=t.sku.id;4==t.itemType&&(e=t.promotionId);var a=t.itemType,i=t.promotionId?t.promotionId:0,o=calItemNum(t);o=o>200?200:o,o=1>o?1:o;var n={type:"num",url:"/cart/opt/editNum.do?pid="+e+"&ptype="+a+"&targetId="+i+"&pcount="+o+"&callback=?",showMsg:!1,time:200,productId:e};return common.ajax(n),!0}function calItemNum(t){var e=t.amount,a=$("input[type='hidden'][name='num_"+t.productId+"_"+t.merchantId+"_"+(0==t.simpleItemType?1:0)+"']");return a.size()>0&&1!=t.bindingFlag&&(e+=parseInt(a.val())),e}function chooseSerialGift(t){var e=$(t).data("productId"),a=$(t).data("merchantId"),i=$(t).data("promotionId"),o=$(t).data("promotionLevelId"),n=$(t).data("num"),r=$(t).data("pmInfoId"),s="/cart/newCart/opt/getMainProductSerialAttr.do?callback=?",c={originalProductId:e,merchantId:a,promotionId:i,promotionLevelId:o,num:n,serialProductId:e};$.getJSON(s,c,function(e){function s(){var e=$(".free_proedit_pop"),a=$(".free_proedit_pop").find(".error_tip"),i=e.find(".confirm"),o=e.find(".prop_list");i.on("click",function(){return e.find(".cur").length!=o.length?(a.show(),!1):($(t).addClass("checked"),$("#batchChooseGift").removeClass("unable"),e.find(".pop_close").trigger("click"),void 0)})}if(utils.isReqSuccess(e)){var c="",l=$(t).data("productId"),d=e.data.serialAttrMap;for(var u in d)if(e.data.serialAttrMap[u]==l){c=u;break}var p=!0,m=refreshSerialAttrStatusForModify(e,p,c,t,0),h=doT.template($("#sub_product_serial_dot").html())($.extend(e.data,{curAttr:c,availAttributes:m,serialGift:"1"}));$(".pop_serial_gift").html(h),$(".error_tip").css("display","none"),$(t).PopupDialog({popupClass:".free_proedit_pop",maskLayer:!0}),s(),$(".prop_list").children("li").on("click",function(){$(this).hasClass("unable")||$(this).addClass("cur").siblings("li").removeClass("cur"),c=$(".free_proedit_pop").find(".prop_item").map(function(t,e){return $(e).data("attributeId")+"-"+$(e).find("li.cur").data("attributeValueId")}).get().join("_"),m=refreshSerialAttrStatusForModify(e,p,c,this,0)}),$(".free_proedit_pop").find(".confirm").on("click",function(){var e=!1;if($(".prop_list").each(function(){return $(this).children("li").hasClass("cur")?void 0:(e=!0,!1)}),e)return $(".error_tip").find("span").text("请选择商品的属性"),$(".error_tip").css("display","block"),!1;var s=d[c];$(t).data("promotionId",i),$(t).data("promotionLevelId",o),$(t).data("merchantId",a),$(t).data("productId",s),$(t).data("num",n),$(t).data("pmInfoId",r),$(t).parent().hasClass("free_list_item")||(require("cart_main_body").ajaxChooseGift(t),newCart.initDialog()),$(".pop_dialog:visible").find(".pop_close").trigger("click")})}})}function calcUnavailableCoordinate(t,e,a,i,o,n,r){for(var s=new Array,c=0;c<t.length;c++){for(var l="",d=1;5>d;d++)if(null!=t[c][d]&&""!=t[c][d])for(var u=e[d-1].attributeValueList,p=0;p<u.length;p++)t[c][d]==u[p].attributeValueAlias&&(l=l+u[p].attributeValueId+"_");s[c]=l,r[l]=t[c].skuId}a=a.split("_");for(var m=new Array,h=new Array,c=0;c<a.length;c++)if(""!=a[c])for(var d=0;d<i[c].length;d++){m=a.slice(0),m[c]=i[c][d]+"";for(var f="",p=0;p<m.length;p++)f=""!=m[p]?f+m[p]+"_":f+c+"";h.push(f)}for(var v=new Array,c=0;c<h.length;c++){var g=h[c].substr(0,h[c].length-1);if($.inArray(g,s)<0){var _=new Array;_=h[c].split("_"),v.push(_[_.length-1]+"-"+(parseInt(_[_[_.length-1]])-1))}}return o||$(n).parents(".prop_dialog_wrap").find("li.seri_attr_value").each(function(){curAttrValueId=$(this).data("attributeValueId")-1,a=$(this).data("attributeId")-1;var t=!1;$.inArray(a+"-"+curAttrValueId,v)<0&&(t=!0),t?$(this).removeClass("unable"):$(this).addClass("unable")}),v}function refreshSerialAttrStatusForModify(t,e,a,i,o){var n=[],r=t.data.avaliableSubProducts;
if(r&&(r=r.split(";"))){for(var s=t.data.allSerialAttributes,c=0;c<s.length;c++){for(var l=s[c].attributeId,d=r.slice(0),u=0;u<s.length;u++){var p=s[u].attributeId;if(p!=l){var m="";if(e){for(var h=a.split("_"),f=0;f<h.length;f++)if(p==h[f].split("-")[0]&&"undefined"!=h[f].split("-")[1]){m=h[f].split("-")[1];break}}else{var v=$(i).parents(".prop_dialog_wrap");v.find(".prop_color_list").each(function(){var t=$(this).attr("data-attribute-id");p==t&&$(this).find(".seri_attr_value").each(function(){$(this).hasClass("cur")&&(m=$(this).attr("data-attribute-value-id"))})})}for(var g=0;g<d.length;g++)if(null!=d[g])for(var _=d[g].split(","),b=0;b<_.length;b++){var y=_[b].split("_");if(y[0]==p){""!=m&&y[1]!=m&&(d[g]=null);break}}}}for(var g=0;g<d.length;g++)if(null!=d[g])for(var _=d[g].split(","),b=0;b<_.length;b++){var y=_[b].split("_");if(y[0]==l){n.push(y[1]);break}}var v;v=$(i).parents("0"==o?".free_proedit_pop":".prop_dialog_wrap"),v.find("li.seri_attr_value").each(function(){curAttrValueId=jQuery(this).attr("data-attribute-value-id");for(var t=!1,e=0;e<n.length;e++)if(n[e]==curAttrValueId){t=!0;break}t?jQuery(this).removeClass("unable"):jQuery(this).addClass("unable")})}for(var k="",w=0;w<n.length;w++)k+=n[w]+"-";return k}}function getRecycleItemInfo(t){var e=$(t);if(!e.data("bind")){var a=e.parents(".main_item").data("identifier"),i=window.itemData[a];return{itemInfo:i,identifier:a,isSuit:4==i.itemType}}}var exports={};return exports.makeUpItem=function(){function t(t,a){e(a,function(){newCart.tipShow($(a),$(t))})}function e(t,a){for(var i=$(t).data("merchantId"),o=$(t).data("difference"),n="#merchant_"+i+"_makeup",r=$(".cart_list_wrap.zy .check_item").map(function(){if($(this).hasClass("checked")){var t=$(this).data("skuId"),e=$(this).data("pkgSkusId");return e&&(t=e),t}}).get().join(","),s=2,c=$(".cart_list_wrap.zy .check.check_item.checked.fresh").map(function(){return $(this).parents(".cart_prod").find(".item_a_money").text()}).get(),l=0,d=0;d<c.length;d++)l+=parseFloat(c[d]);for(var u=$(".cart_list_wrap.zy .check.check_item.checked.nofresh").map(function(){return $(this).parents(".cart_prod").find(".item_a_money").text()}).get(),p=0,m=0;m<u.length;m++)p+=parseFloat(u[m]);s=0==c.length&&0!=u.length?2:0!=c.length&&0==u.length?1:l>86?2:p>86?1:3;var h=$(".cart_list_wrap.zy .check_item").map(function(){return $(this).hasClass("checked")?$(this).data("skuWeight"):void 0}).get().join();1==o?(max="15",min="0"):2==o?(max="30",min="15"):3==o?(max="45",min="30"):4==o?(max="60",min="45"):(o=5,max="86",min="60");var f=1==s?"1":"0";$(".cur.coudan_type").hasClass("isfresh_btn")&&(f="1");var v={max:max,min:min,area:$.cookie("yhd_location").replace(new RegExp("_","g"),","),wt:20-h,fr:f};common.blockUI();var g={p:"619108",pin:$.cookie("pin"),skus:r,lid:null!=$.cookie("provinceId")?$.cookie("provinceId"):"2",lim:24,uuid:$.cookie("cart_cookie_uuid"),hi:JSON.stringify(v),ec:"utf-8"},_="/cart/opt/diviner.do";$.ajax({type:"GET",jsonpCallback:"jQuery"+$.now(),dataType:"jsonp",url:_,data:g,success:function(r){if("00000000"==r.code&&r.data.success){r.data.hasFresh=s;var c=doT.template($("#makeUpItems").html())(r.data);$(n).html(c),$(n).find(".switchTab").unbind("click").bind("click",function(){e(this)}),$(".coudan_type").unbind("click").bind("click",function(){$(this).addClass("cur").siblings("a").removeClass("cur"),e(this)}),newCart.makeupScroll("switchTab"==$(t).attr("class")?"#merchant_"+$(t).data("merchantId")+"_makeup":"#"+$(t).attr("id")+"_makeup"),$("#table_"+o).addClass("cur"),"1"==f?$(".isfresh_btn").addClass("cur").siblings("a").removeClass("cur"):$(".notfresh_btn").addClass("cur").siblings("a").removeClass("cur"),$(".makeup_prod .tab").find("li").on("click",function(){$(this).addClass("cur")});var l='.makeup_tip[data-merchant-id="'+i+'"]',d=null,u=$(l).find("a");d&&d.length&&($(l).html(""),$(u).appendTo($(l).append(d))),$(".similar_prod").find(".prod_item").hover(function(){$(this).addClass("cur")},function(){$(this).removeClass("cur")}),$(".makeup_prod .add_btn").on("click",function(){var t=$(this).data("pmId"),e=$(this).data("shoppingCount");exports.ajaxAddProductToCart(t,e)}),$(n).find("li").attr("merchantId",i).attr("difference",o),a&&a()}},complete:function(){common.unblockUI()}})}$(".cart_list").each(function(){$(this).find(".checked").length||$(this).find(".free_pos").remove()}),$(".order_makeup_btn").on("click",function(){var e="#"+$(this).attr("id")+"_makeup";if($(e).hasClass("slideUp")){var a=$(this).data("merchantId"),i='.makeup_tip[data-merchant-id="'+a+'"]',o=$(i).find("a"),n=$("#hidden_delivery_fee_desc_"+a).val();n&&n.length&&($(i).html(""),$(o).appendTo($(i).append(n))),newCart.tipShow($(this),$(e))}else t(e,this)})},exports.payBarBatchChooseGift=function(){function t(){$(".free_list_item").each(function(){$(this).find(".free_check").hasClass("checked")&&r++}),0==r?$("#batchChooseGift").addClass("unable"):$("#batchChooseGift").removeClass("unable")}var e=new Array,a=new Array,i=new Array,o=new Array,n=new Array,r=0,s="",c="";$(".free_check").on("click",function(e){e.stopPropagation();var a=$(this).data("isSeries");if($(this).hasClass("checked"))$(this).removeClass("checked"),1==a&&$(this).data("productId",$(this).data("mainProductId"));else{var i=$(this).data("selectType"),o=$(this).attr("name");2==i&&$('a[name="'+o+'"]').each(function(){$(this).removeClass("checked")}),1==a?chooseSerialGift(this):$(this).addClass("checked")}t()}),$("#batchChooseGift").on("click",function(t){t.stopPropagation(),$(this).hasClass("unable")||($(".free_list_item").each(function(){$(this).find(".free_check").hasClass("checked")&&(e[r]=$(this).find(".choose_gift").data("promotionId"),a[r]=$(this).find(".choose_gift").data("promotionLevelId"),i[r]=$(this).find(".choose_gift").data("productId"),o[r]=$(this).find(".choose_gift").data("merchantId"),n[r]=$(this).find(".choose_gift").data("num"),s+="&promotionIDs="+e[r]+"&promotionLevelIDs="+a[r]+"&promotionGiftIDs="+i[r]+"&promotionGiftMerchantIDs="+o[r]+"&promotionGiftNum="+n[r])}),s=s.substring(1,s.length),c="/cart/newCart/opt/addPromo.do?"+s+"&callback=?",newCart.initDialog(),common.ajax({url:c}))})},exports.ajaxAddProductToCart=function(t,e,a){if(t){var i="/cart/opt/add.do?pid="+t+"&pcount="+(e||1)+"&ptype="+(a||1)+"&callback=?";common.ajax({url:i})}},exports.ajaxAddSimilarProductToCart=function(t,e,a){if(t&&e){var i="/cart/newCart/opt/add.do?productId="+t+"&merchantId="+e+"&num="+(a||1)+"&callback=?";common.ajax({url:i})}},exports.loadWarningMessage=function(){var t,e="/cart/mod/advertisementService.do",a=$.cookie("yhd_location");null!=a&&(t=a.split("_")[0]);var i={mcSiteId:"1",code:"GWCPC_YMGG_MR_MR",provinceId:t,level:"4"};$.ajax({url:e,data:i,dataType:"json",success:function(t){if(t.data&&t.data.sourceList&&t.data.sourceList[0]&&t.data.sourceList[0].name){var e=doT.template($("#dot-messageWrap").html())(t.data.sourceList[0].name);$(".top_tip").show().children("p").html(e)}else $(".top_tip").hide()}})},exports.editNum=function(t){$div=$(t).parent();var e=$(t).parents(".main_item").data("identifier"),a=window.itemData[e];a.input=$div.find(".input"),a.amount=parseInt($div.find(".input").val()),calSubTotal(a)},exports.ajaxChooseGift=function(t){var e=$(t).data("pskuid"),a=$(t).data("promoid"),i=window.promotionData[a],o=[e];$.each(i.selectedGifts,function(t,e){o.push(e.id)});var n="/cart/opt/addGiftsOfMZ.do?pids="+o.join(",")+"&promoId="+a+"&callback=?";common.ajax({url:n})},exports.initCheckOutBar=function(t){if(t.cartVo&&t.cartVo.empty)return void $("#checkOutBar").html("").hide();var e=$("#dot-checkOutBar").html(),a=doT.template(e)(t);$("#checkOutBar").html(a).show();var i=doT.template($("#cartPreview").html())(t.checkOutPreviewVo);$(".pay_allprod_tips").html(i),$(".pvw_sale_title .close").on("click",function(){newCart.setCheckOutButtonStatus(!0),$(".pay_tips").hide()}),$(".settle_accounts_btn").on("click",function(){require("checkOut").singleCheckout(this)}),newCart.columnBarArrow(),newCart.columnBar(),newCart.setCheckOutButtonStatus(!0);var o=$(".cart_prod.clearfix.unable").map(function(){return $(this).find(".del_btn").data("deleteId")}).get().join(",");""==o&&$("#batchDelete").hide()},exports.loadRedemption=function(){var t=$(".check_item").map(function(){return $(this).hasClass("checked")?$(this).data("check-str")+"=1":void 0}).get().join(",");if(null==t||0==$.trim(t).length)return void $("#redemptions").empty();var e="/cart/newCart/mod/cart4Redeem.do?callback=?";$.ajax({type:"get",dataType:"json",url:e,success:function(t){if(!common.reqSucceed(t)||!t.data)return void $("#redemptions").empty();var e=doT.template($("#dot-redemptions").html())(t.data);$("#redemptions").html(e),$(".sale_item").each(function(){var t=$(this),e=t.find(".add_shopcart");t.hover(function(){e.addClass("add_shopcart_show").hover(function(){e.removeClass("as_icon_show").addClass("as_txt_show")},function(){e.removeClass("as_txt_show").addClass("as_icon_show")})},function(){e.removeClass("add_shopcart_show")})}),$(".redem.add_shopcart").on("click",function(){exports.ajaxChooseGift(this)}),newCart.changeBuyScroll();try{require(["content_tracker_expo"],function(t){t.run("shopping_specPriceRedeBuy_adContentTrackerEvent","brain")})}catch(a){}}})},gotrackerWithSpmData=function(t,e,a,i){var o=loli.spm.getData(i);o.positionTypeId="4"},exports.loadRecommendation=function(){var t="/cart/opt/diviner.do?callback=?";$.ajax({type:"get",dataType:"json",url:t,data:{p:"619125",skus:"",lid:null!=$.cookie("provinceId")?$.cookie("provinceId"):"2",lim:"40",ec:"utf-8",pin:$.cookie("pin")},success:function(t){if("00000000"==t.code){var e=t.data,a=e.data;if(e&&1==e.success&&a){var i=$("#recommendation_dot").html(),o=doT.template(i);$("#recommendation").html(o(a)),newCart.guessLikeScroll(),newCart.prodHover(),$(".recom_add").on("click",function(){var t=$(this).data("pid"),e=$(this).data("shoppingCount"),a=1;exports.ajaxAddProductToCart(t,a,e)})}else $("#recommendation").html("")}}})},exports.recommendGoods=function(){$(".similar_btn").click("click",function(){if($(this).hasClass("notEmpty")||$(this).siblings(".similar_prod").hasClass("slideUp"))newCart.tipShow($(this),$(this).siblings(".similar_prod"),$(this).parent());else{$(this).removeClass("notEmpty");var t=$(this).data("skuId"),e=($(this).data("merchantId"),this),a="<p class='no_empty'><i></i>暂无推荐商品</p>";$.ajax({type:"GET",dataType:"jsonp",jsonpCallback:"jQuery"+$.now(),timeout:1e3,url:"/cart/opt/diviner.do",data:{p:"619126",sku:t,lid:null!=$.cookie("provinceId")?$.cookie("provinceId"):"2",lim:"24",uuid:$.cookie("cart_cookie_uuid"),ec:"utf-8",pin:$.cookie("pin")},error:function(){$(e).siblings(".similar_prod").html(a)},success:function(t){var i=t.data,o=i.data;if(i&&o&&1==i.success&&i.data.length>0){var n=doT.template($("#similar_product_dot").html())(i);$(e).siblings(".similar_prod").html(n),$(e).addClass("notEmpty");try{require(["content_tracker_expo"],function(t){t.run("shopping_productRecommend_adContentTrackerEvent","brain")})}catch(r){}$(e).siblings(".similar_prod").find(".prod_item").hover(function(){$(this).addClass("cur")},function(){$(this).removeClass("cur")}),$(e).siblings(".similar_prod").find(".add_btn").on("click",function(){var t=$(this).data("pmId"),e=$(this).data("shoppingCount");exports.ajaxAddProductToCart(t,e)})}else $(e).siblings(".similar_prod").html(a);newCart.tipShow($(e),$(e).siblings(".similar_prod"),$(e).parent())}})}})},exports.checkItemLimit=function(data){var specialOfferItemNum,specialOfferItem;specialOfferItem=data.mainItem?data.mainItem:data,specialOfferItem.promoteOverLimitDisplayTag&&(specialOfferItemNum=eval($('[data-tag="'+specialOfferItem.promoteOverLimitDisplayTag+'"]').map(function(){return $(this).siblings(".item_num").find(".input").val()}).get().join("+")));var check={aborted:!0},inputNum=data.inputNum,validateNum=data.inputNum;if(data.validateNum=data.inputNum,data.mainItem&&data.validateNum>data.mainItem.allNum&&(validateNum=data.mainItem.allNum,check.msg="搭售品数量不能超过主品数量"),data.currentStockNum){var limitedStockMsg="";if(data.currentStockNum<200?(data.maxNum=data.currentStockNum,limitedStockMsg="库存有限，"):data.maxNum=200,data.maxNum<=0)return check.msg="该商品 已下架或无库存",check;!data.mainItem&&specialOfferItemNum&&specialOfferItemNum>data.maxNum?(validateNum=data.inputNum-(specialOfferItemNum-data.maxNum),check.msg="该商品"+limitedStockMsg+"您最多只能购买"+validateNum+"件"):data.maxNum<validateNum&&(check.msg="该商品"+limitedStockMsg+"您最多只能购买"+data.maxNum+"件",validateNum=data.maxNum)}if(data.mainItem)return check.msg||(check.aborted=!1),data.validateNum=validateNum,check;var shoppingCountNum=data.sku.shoppingCount;switch(data.simpleItemType=0,data.simpleItemType){case 0:if(data.sensitive&&data.dailyPurchaseMaxCount){var buyMore=data.dailyPurchaseMaxCount-data.dailyCount;validateNum>buyMore&&(validateNum=buyMore,check.msg="该商品为特价限购商品，最多购买"+data.dailyPurchaseMaxCount+"件",data.dailyCount>0&&(check.msg+="，您已购买过"+data.dailyCount+"件，还能再购买"+buyMore+"件!"))}else if(data.perOrderQuota&&data.perOrderQuota<validateNum)validateNum=data.perOrderQuota,check.msg="该商品[每单限购"+data.perOrderQuota+"件]";else if(shoppingCountNum>1&&shoppingCountNum>validateNum)check.msg="该商品["+shoppingCountNum+"件起购]",validateNum=shoppingCountNum,check.checkPoint="起购";else{var promoteType=data.promoteType;data.totalLimitNum>0&&data.totalLimitNum<validateNum&&(2==promoteType||4==promoteType?(check.msg="该商品[每单限购"+data.totalLimitNum+"件],超过则以1号店价购买",check.aborted=!1):(5==promoteType||data.presell||6==promoteType)&&(validateNum=data.totalLimitNum,check.msg="该商品[限购"+data.totalLimitNum+"件]")),data.userLimitNum>0&&validateNum>data.userLimitNum&&(check.msg="该商品[每人限购"+data.userLimitNum+"件]",data.presellcommon||6==promoteType||3==promoteType?validateNum=data.userLimitNum:(check.msg+=",超过则以1号店价购买",check.aborted=!1))}break;case 2:data.landingNumLimit&&validateNum>data.landingNumLimit?(check.msg="该商品为特价商品，您最多只能购买"+data.landingNumLimit+"件",validateNum=data.landingNumLimit):shoppingCountNum>1&&shoppingCountNum>validateNum&&(check.msg="该商品["+shoppingCountNum+"件起购]",validateNum=shoppingCountNum);break;case 3:data.userLimitNum>0&&validateNum>data.userLimitNum&&(validateNum=data.userLimitNum,check.msg="积分商品每单限购"+data.userLimitNum+"件")}return check.msg||(check.aborted=!1),data.validateNum=validateNum,check},exports.numAct=function(){function t(t){$div=$(t).parent();var e=$(t).parents(".main_item").data("identifier"),a=window.itemData[e];a.inputNum=$div.find(".input").val();var i=exports.checkItemLimit(a);if(i.aborted){var o='<div class="tip_dialog num_dialog"><div class="t_arrow t_arrow_top"><span></span><i></i></div><p>'+i.msg+'</p><div class="btn_box"><a href="javascript:;" class="confirm">确定</a></div></div>';!$(t).hasClass("input")&&$(t).addClass("unable"),$(".cart_item.unable").find("input").attr("readonly","readonly"),$div.find(".input").val(a.validateNum),$div.find(".input").siblings("input").val(a.num),"起购"!=i.checkPoint&&($(t).parents(".item_num").append(o),$(".num_dialog").on("click",".confirm",function(){$(".num_dialog").remove(),a.num!=a.validateNum&&exports.editNum(t)}))}else if(i.msg){var o='<div class="tip_dialog num_dialog"><div class="t_arrow t_arrow_top"><span></span><i></i></div><p>'+i.msg+'</p><div class="btn_box"><a href="javascript:;" class="cancel">取消</a><a href="javascript:;" class="confirm">继续添加</a></div></div>';$(t).parents(".item_num").append(o),$(".num_dialog").on("click",".confirm",function(){$(".num_dialog").remove(),$div.find(".input").val(a.validateNum),exports.editNum(t)}).on("click",".cancel",function(){return $div.find(".input").val(a.num),$(".num_dialog").remove(),!1})}else a.num!=a.validateNum&&exports.editNum(t)}function e(t){var e=t.parents(".cart_prod").find(".check_item");2!=e.data("checkType")&&e.addClass("checked")}$(".cart_item.unable").find("input").attr("readonly","readonly"),$(".num_act").find("input,.add,.minus").off(),$(".num_act").find("input").blur("input propertychange",function(){$(this).attr("readonly")||t(this)}),$(".num_act").find("input").on("input propertychange",function(){var t=$(this).val();t=Math.min(Math.max(parseInt(0|t.replace(/\D/g,""),10),1),200),$(this).val(t)}),$(".num_act").find(".add").on("click",function(){function a(){200>o&&o++;var a=i.siblings("input").val(o);t(i),a.val()>1&&i.siblings(".minus").removeClass("unable"),e(i)}if($(this).hasClass("unable"))return!1;var i=$(this),o=parseInt($(this).siblings("input").val());a()}),$(".num_act").find(".minus").on("click",function(){function a(){n--,n==i?o.addClass("unable"):"",o.siblings(".add").removeClass("unable").siblings("input").val(n),t(o),e(o)}if($(this).hasClass("unable"))return!1;var i,o=$(this),n=parseInt(o.siblings("input").val());i=o.attr("data-min")?parseInt(o.attr("data-min")):1,i>=n?o.addClass("unable"):a()})},exports.initSubProductSerialAttr=function(){var t=!0;$(".serial_product").off().on("click",function(e){e.stopPropagation();var a=this;if($(a).hasClass("down")||$(a).siblings(".prop_dialog").html())return void newCart.tipShow($(a),$(a).siblings(".prop_dialog"));var i=$(this).data("skuId"),o="/cart/opt/series.do?callback=?",n=$.param({id:i,u_source:"yhd"},!0),r=$(this).find(".attributeName").map(function(){return $(this).html()}).get().join("_"),s=r.split("_"),c="";$.getJSON(o,n,function(o){if(utils.isReqSuccess(o)&&"1"==o.data.retCode){var n=o.data.saleProp,r=new Array,l=new Array;if(null!=n)for(var d=1;3>=d;d++){var u=n[d],p=new Array;if(null!=u&&""!=u){var m=new Object;m.attributeId=d,m.attributeName=u;for(var h=new Array,f=0;10>f;f++){var v=o.data.salePropSeq[d][f];if(null!=v&&""!=v){var g=new Object;g.attributeValueId=f+1,p[f]=f+1,g.attributeValueAlias=v,h[f]=g}}h.length>0&&(m.attributeValueList=h,r[d-1]=m)}l[d-1]=p}t=!0;for(var _=o.data.newColorSize,b=0;b<_.length;b++)if(_[b].skuId==i){for(var y="",k=1;5>k;k++)if(null!=_[b][k]&&""!=_[b][k]){y=y+_[b][k]+"_";for(var w=r[k-1].attributeValueList,C=0;C<w.length;C++)_[b][k]==w[C].attributeValueAlias&&(c=c+w[C].attributeValueId+"_")}s=y.split("_");break}var I=new Object,x=calcUnavailableCoordinate(_,r,c,l,t,this,I),T=doT.template($("#sub_product_serial_dot").html())($.extend(o,{allSerialAttributes:r,curAttr:s,unavailableCoordinate:x}));$(a).siblings(".prop_dialog").html(T),newCart.tipShow($(a),$(a).siblings(".prop_dialog")),$(a).parent().find(".prop_list").children("li").on("click",function(){$(this).hasClass("unable")||$(this).addClass("cur").siblings("li").removeClass("cur"),t=!1,c=$(a).parent().find(".prop_item").map(function(t,e){return $(e).find("li.cur").data("attributeValueId")}).get().join("_")+"_",calcUnavailableCoordinate(_,r,c,l,t,this,I);var e,o=$(this).parents(".prop_edit").find(".serial_product").data(i).skuId,n=$(this).parents(".prop_edit").find(".prop_item").map(function(){return $(this).find("li.cur").data("attributeValueId")}).get().join("_")+"_";null!=I[n]&&""!=I[n]&&(e=I[n]),e!=o?$(this).parents(".prop_edit").find(".confirm").removeClass("unable"):$(this).parents(".prop_edit").find(".confirm").addClass("unable")}),$(a).siblings(".prop_dialog").find(".confirm,.close").on("click",function(){if(e.stopPropagation(),newCart.initDialog(),$(this).hasClass("confirm")&&!$(this).hasClass("unable")){var t=$(this).parents(".prop_edit").find(".prop_item").map(function(){return $(this).find("li.cur").data("attributeValueId")}).get().join("_")+"_";if(null!=I[t]&&""!=I[t])var a=I[t];var i=$(this).parents(".cart_prod").find(".del_btn").data("deleteId"),o=$.param({deleteId:i},!0),n="/cart/opt/delete.do?callback=?",r=$(this).parents(".cart_prod").find(".input").val();$.getJSON(n,o,function(t){if(utils.isReqSuccess(t)){var e=$.param({pid:a,ptype:"1",pcount:r},!0),i="/cart/opt/add.do?callback=?&"+e;common.ajax({url:i})}})}})}})}),$(".change_free").on("click",function(t){t.stopPropagation();var e=$(this).data("promotionid"),a=window.promotionData[e];if(!a.giftStock){var i=$.map(a.gifts,function(t,e){var a=t.id,i=t.num||1,o="skus["+e++ +"]";return o+".skuId="+a+"&"+o+".num="+i}).join("&");$.ajax({url:"/cart/mod/queryStock.do",type:"get",data:i,dataType:"jsonp",async:!1,success:function(t){if(t.code="00000000"){var e=a.giftStock=t.data;e&&$.each(a.gifts,function(t,a){var i=e[a.id];a.hasStock=i?["33","39","40"].indexOf(i)>=0:!0})}}})}var o=doT.template($("#select_free_dot").html())(a);$(".select_free_dialog").html(o),$(".select_free_add").click(function(){$(".select_free_add").hasClass("serial_product")?chooseSerialGift(this):(exports.ajaxChooseGift(this),newCart.initDialog())}),newCart.initDialog(),$(this).PopupDialog({popupClass:".select_free_dialog",maskLayer:!1}),newCart.makeupScroll(".makeup_list")})},exports.moveToFavorite=function(t){function e(){newCart.alert("您已收藏过该商品",2)}if($(t).hasClass("got"))return void e();var a=$(t).data("productId"),i="/cart/opt/moveToFavorite.do?productId="+a+"&callback=?";$.getJSON(i,function(a){common.reqSucceed(a)&&("00000000"==a.code?(setTimeout(function(){exports.doDelete({btn:$(t,"1").siblings(".del_btn")})},1500),newCart.animateParabola(t,document.getElementById("collect")),exports.myCollection()):(a.code="00000001")&&e())})},exports.myCollectionProdutIds,exports.myCollection=function(){var t="/cart/mod/myFavorites.do?callback=?";$.getJSON(t,function(t){if(utils.isReqSuccess(t)&&t.data){t.data.list&&t.data.list.length&&(exports.myCollectionProdutIds=[],$(t.data.list).each(function(){exports.myCollectionProdutIds.push(this.productId)}),t.data.list.length>10&&(t.data.list.length=10)),exports.showCollected();var e=doT.template($("#t_panel_cont_favor_dot").html())(t.data);$(".t_panel_cont_favor").find(".t_panel_wrap").html(e),$(".collected_add").on("click",function(){exports.ajaxAddProductToCart($(this).data("productId"))});var a=$(".t_panel_cont_favor").find("li").length;$(".t_warp_slide_tabs").find("#collect").find(".c_lit_tip").html(a),$(".t_panel_cont_favor .ti_name").each(function(){$(this).dotdotdot({wrap:"letter",height:40})})}})},exports.showCollected=function(){if(exports.myCollectionProdutIds&&exports.myCollectionProdutIds.length)for(var t=0;t<exports.myCollectionProdutIds.length;t++)$btn=$(".collect_btn_"+exports.myCollectionProdutIds[t]),$btn.addClass("collected"),$btn.attr("title","已收藏过该商品")},exports.claimCoupon=function(){var t=$(".quickly_coupon").map(function(){return $(this).data("merchantId")}).get();t&&t.length&&$.getJSON("/cart/opt/getCouponAction.do?callback=?",$.param({merchantIds:t},!0),function(e){e.data&&($(t).each(function(){var a=this,i=e.data.merchantCouponMap[a];i&&i.length?$("#coupon_"+a).show().find(".coupon_dialog").html(doT.template($("#claim_coupon_dot").html())({coupons:i,merchantId:t[a]})):e.data.merchantHasActivityCouponNoLogin[a]&&$("#coupon_"+a).show().off().click(function(){yhdPublicLogin.showLoginDiv("",!1,"2")})}),$(".claim_coupon").click(function(){var t=this;$.ajax({url:"/cart/opt/claimCouponAction.do?callback=?",type:"POST",dataType:"jsonp",data:{couponActiveNumber:$(t).data("couponActiveNumber")},success:function(e){utils.isReqSuccess(e)&&(e.data&&e.data.claimResult?$(t).addClass("has_get").removeClass("get").html('<i class="iconfont"></i>已领取').off():newCart.alert(e.data&&e.data.errMsg||"领取抵用券失败，请稍后再试",2))}})}))})},exports.shopData=function(){var t="/cart/opt/getShopData.do",e=$(".cart_tit.clearfix").map(function(){return"8888"!=$(this).data("merchantId")&&"8899"!=$(this).data("merchantId")?$(this).data("merchantId"):void 0}).get().join(","),a={venderList:e};0!=a.venderList.length&&$.ajax({url:t,data:a,dataType:"json",success:function(t){if(t.data&&t.data.model){var a=t.data.model;if(a){window.shopinfo=a;$(e.split(",")).each(function(t,e){var i=a[t].pcShopUrl;null!=i&&$(".cart_tit.clearfix[data-merchant-id="+e+"]").find(".label.vender").attr("href","//"+i),t++})}}}})},exports.partialLimit=function(){if(null!=$.cookie("yhd_location")){var t="/cart/opt/getSkuPartition.do",e=$(".check_item.normal_item").map(function(){var t=$(this).data("skuId"),e=0;$(this).hasClass("fresh")&&(e=1);var a=$(this).data("skuCategory");return t+"_"+a+"_"+e}).get().join("-"),a={skuInfos:e,localId:$.cookie("yhd_location").replace(new RegExp("_","g"),",")};$.ajax({url:t,data:a,dataType:"json",success:function(t){utils.isReqSuccess(t)&&(window.partialData=t.data,$(".item_num").each(function(){t.data&&window.partialData[$(this).data("skuId")]&&("partialsupport"==window.partialData[$(this).data("skuId")].saleStatus||"notsupport"==window.partialData[$(this).data("skuId")].saleStatus)&&($(this).find(".stock").html(""),$(this).find(".partial").html("该商品在该地区暂不支持销售"))}))}})}},exports.doDelete=function(t){var e=t.deleteIds||$(t.btn).data("deleteId");return e?void common.ajax({type:"delete",url:"/cart/opt/delete.do?callback=?",deleteId:e,deleteType:0,time:200,success:function(e){if(!t.deleteIds&&utils.isReqSuccess(e)&&t.recycleItemInfo){var a=JSON.stringify(t.recycleItemInfo.itemInfo);$.post("/cart/opt/moveToRecycleBin.do",{itemInfo:a,identifier:t.recycleItemInfo.identifier},function(){exports.shoppingRecycleBin()})}}}):!0},window.recycleBin={},exports.shoppingRecycleBin=function(t){var e="/cart/mod/shoppingRecycleBin.do?callback=?";t&&(e=e+"&identifiers[0]="+t),$.getJSON(e,function(t){if(utils.isReqSuccess(t)&&t.data){var e=doT.template($("#recycler_dot").html())(t.data.shoppingRecycleBin);$(".t_panel_cont_recycler").find(".t_panel_wrap").html(e),window.recycleBin=null,window.recycleBin={},$(t.data.shoppingRecycleBin).each(function(){window.recycleBin[this.identifier]=this}),$(".recycle_add").off().on("click",function(){var t=$(this).data("identifier"),e=window.recycleBin[t],a=JSON.parse(e.itemInfo);a.num=a.num||1;var i=a.sku.id||a.promotionId,o=""==a.sku.id?2:1;common.ajax({url:"/cart/opt/add.do?pid="+i+"&ptype="+o+"&pcount="+a.num,success:function(e){utils.isReqSuccess(e)&&exports.shoppingRecycleBin(t)}})});var a=$(".t_panel_cont_recycler").find("li").length;$(".t_warp_slide_tabs").find("#trash").find(".c_lit_tip").html(a),a?$(".t_panel_cont_recycler").find(".delete_all").show():$(".t_panel_cont_recycler").find(".delete_all").hide(),$(".t_panel_cont_recycler .ti_name").each(function(){$(this).dotdotdot({wrap:"letter",height:40})})}})},exports.bindItemEvents=function(){$(".cart_item").on("click",".del_btn",function(){var t=this,e=getRecycleItemInfo(t);e?e.isSuit?exports.doDelete({btn:t,recycleItemInfo:e}):(newCart.animateParabola(this,document.getElementById("trash")),setTimeout(function(){exports.doDelete({btn:t,recycleItemInfo:e})},1500)):newCart.dialog({tit:"确认删除",txt:"删除后不可撤销",callback:function(){exports.doDelete({btn:t})}})}),$(".cart_item").on("click",".collect_btn",function(){exports.moveToFavorite(this)}),$(".lt_delete").on("click",function(){var t=$(".main_item").map(function(){return $(this).find("a.checked").length&&$(this).find(".del_btn").length?$(this).find(".del_btn").data("deleteId"):void 0}).get().join(",");if(!t)return void newCart.alert("请选择需要删除的商品",1);var e=this;newCart.dialog({tit:"批量删除商品",txt:"确定批量删除所选商品吗？",callback:function(){exports.doDelete({btn:e,deleteIds:t})}})}),$(".lt_disable").on("click",function(){var t=$(".cart_prod.clearfix.unable").map(function(){return $(this).find(".del_btn").data("deleteId")}).get().join(","),e=this;newCart.dialog({tit:"批量清除无效商品",txt:"确定要删除无效商品吗？",callback:function(){exports.doDelete({btn:e,deleteIds:t})}})}),$(".delete_gift").on("click",function(t){t.stopPropagation();var e=$(this).parent().find(".group_gift_self_use").map(function(){return $(this).data("deleteId")}).get().join(","),a=$(this).data("promoid"),i=$(this).data("pid");return newCart.dialog({tit:"确定删除",txt:"确定从购物车中删除吗？",callback:function(){var t=window.promotionData[a],o=[];if($.each(t.selectedGifts,function(t,e){e.id!=i&&o.push(e.id)}),o.length>0){var n="/cart/opt/addGiftsOfMZ.do?pids="+o.join(",")+"&promoId="+a+"&callback=?";common.ajax({url:n})}else common.ajax({type:"delete",url:"/cart/opt/removeGiftsOfMZ.do?promoId="+a+"&callback=?",deleteId:e,deleteType:1,time:200})}}),!1})},exports.refreshMainBody=function(t){if(common.reqSucceed(t)){window.itemData=null,window.itemData={};var e=doT.template($("#cart_main_body_dot").html())(t.data);$("#cart_main_body").replaceWith(e),$("img").one("error",function(){this.src="//image.yihaodianimg.com/front-homepage/global/images/defaultproduct.jpg"});var a="{}";t&&t.data&&t.data.cartVo&&(a=t.data.cartVo.allProductIdsStr),common.reloadDelete(),exports.numAct(),exports.initCheckOutBar(t.data),newCart.check(),exports.initSubProductSerialAttr(),exports.payBarBatchChooseGift(),exports.makeUpItem(),exports.loadWarningMessage(),exports.recommendGoods(),!exports.isMedicine&&exports.loadRecommendation(),exports.showCollected(),exports.bindItemEvents(),newCart.tipDialog(),exports.processAreaInfo(),newCart.modAreaSelect(),newCart.initClass(),newCart.otherJs(),newCart.prodHover(),newCart.freeEvents(),newCart.initDialog(),newCart.activityDroplist(),newCart.initPopChat(),exports.shopData(),exports.partialLimit(),exports.storeCartNum(t.data),exports.triggerYuyueCountdown(),window.synccookie.dosync("unpl")}},exports.initPrismBar=function(){exports.shoppingRecycleBin()},exports.processAreaInfo=function(){var t="/cart/opt/getAreaInfo.do?callback=?";$.getJSON(t,function(t){$("#cart_province_id").val(t.data.currProvinceId),$("#cart_province_name").val(t.data.currProvinceName),$("#cart_city_id").val(t.data.currCityId),$("#cart_city_name").val(t.data.currCityName),$("#cart_county_id").val(t.data.currCountyId),$("#cart_county_name").val(t.data.currCountyName),newCart.areaInit()})},exports.initMainBody=function(){var t="/cart/mod/newMainbody.do?callback=?";common.blockUI(),$.getJSON(t,function(t){exports.refreshMainBody(t),common.unblockUI()})},exports.reloadMainBody=function(){var t="/cart/mod/newMainbody.do?callback=?";$.getJSON(t,function(t){exports.refreshMainBody(t)})},exports.storeCartNum=function(t){t&&$.cookie("cart_num",t.allItemNum||0,{path:"/",domain:".yhd.com"})},exports.triggerYuyueCountdown=function(){var t;$(".countdown").each(function(){$(this).data("ellapsed")?($(this).text("00:00:00"),t=!0):$(this).countdown({time:1e3*$(this).data("time"),onTick:function(t,e,a,i){t.html(e+":"+a+":"+i)},onExpiry:function(){setTimeout(function(){exports.reloadMainBody()},1e3)}})}),t&&setTimeout(function(){exports.reloadMainBody()},2e3)},exports.init=function(){exports.isMedicine=!!$("#isMedicine").val(),exports.initMainBody(),exports.initPrismBar(),newCart.toolbar()},exports}),define("searchBar",["jquery"],function(t){var e={};return e.areaInit=function(){function e(e,a,i,o){var n=t("#keyword"),r="//search.yhd.com";if(e?e instanceof jQuery&&(n=e,e=n.val()):e=n.val(),e=e.replace(/\//gi," "),e&&"请输入关键词"!=e){var s="0";if(t("#leaf").size()>0&&(s=t("#leaf").val()),o){var c=r+"/c0-0-0/b/a-s1-v2-p1-price-d0-f0b-m1-rt0-pid-mid0-k"+encodeURIComponent(encodeURIComponent(e))+"/";return void loli.spm.refreshPage(c,n)}var l=t("#recommendId").val(),d=t("#recommendName").val();if(null!=a&&"0"!=a){var c=r+"/c"+a+"-"+i+"/k"+encodeURIComponent(encodeURIComponent(e))+"/";loli.spm.openPage(n,c)}else if(null!=l&&""!=l){var c=r+"/c"+l+"-"+d+"/k"+encodeURIComponent(encodeURIComponent(e))+"/";loli.spm.openPage(n,c)}else{var c=r+"/c"+s+"-0/k"+encodeURIComponent(encodeURIComponent(e))+"/";loli.spm.openPage(n,c)}}}t("#keyword").keydown(function(t){t=t||window.event;var a=t.keyCode;"13"==a&&e()}),t("#search").click(function(){e()})},e.init=function(){this.areaInit()},e}),requirejs.config({baseUrl:"/statics/shopping/",paths:{dotdotdot:"pc/js/lib/jquery.dotdotdot.min",doT:"pc/js/lib/doT",blockUI:"pc/js/lib/jquery.blockUI",countdown:"pc/js/lib/countdown",scroll:"pc/js/lib/scroll",dialog:"pc/js/lib/dialog",parabola:"pc/js/lib/parabola",newCart:"pc/js/newCart",searchBar:"pc/js/search_bar_cart",common:"pc/js/cart_common",utils:"pc/js/cart_utils",WebIM:"pc/js/WebIM",cart_main_body:"pc/js/cart_main_body"},shim:{dialog:["jquery"],scroll:["jquery"]}}),requirejs(["cart_main_body","searchBar"],function(t,e){t.init(),e.init()}),define("cart_config",function(){});